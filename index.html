<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides tools for creating and working with survey replicate weights,
  extending functionality of the survey package from Lumley (2004) &lt;doi:10.18637/jss.v009.i08&gt;.
  Implements bootstrap methods for complex surveys, including the generalized survey bootstrap
  as described by Beaumont and Patak (2012) &lt;doi:10.1111/j.1751-5823.2011.00166.x&gt;.
  Methods are provided for applying nonresponse adjustments to
  both full-sample and replicate weights as described by 
  Rust and Rao (1996) &lt;doi:10.1177/096228029600500305&gt;.
  Implements methods for sample-based calibration described by Opsomer and Erciulescu (2021) 
  &lt;https://www150.statcan.gc.ca/n1/pub/12-001-x/2021002/article/00006-eng.htm&gt;.
  Diagnostic functions are included to compare weights and weighted estimates
  from different sets of replicate weights.">
<title>Tools for Creating, Updating, and Analyzing Survey Replicate Weights • svrep</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Tools for Creating, Updating, and Analyzing Survey Replicate Weights">
<meta property="og:description" content="Provides tools for creating and working with survey replicate weights,
  extending functionality of the survey package from Lumley (2004) &lt;doi:10.18637/jss.v009.i08&gt;.
  Implements bootstrap methods for complex surveys, including the generalized survey bootstrap
  as described by Beaumont and Patak (2012) &lt;doi:10.1111/j.1751-5823.2011.00166.x&gt;.
  Methods are provided for applying nonresponse adjustments to
  both full-sample and replicate weights as described by 
  Rust and Rao (1996) &lt;doi:10.1177/096228029600500305&gt;.
  Implements methods for sample-based calibration described by Opsomer and Erciulescu (2021) 
  &lt;https://www150.statcan.gc.ca/n1/pub/12-001-x/2021002/article/00006-eng.htm&gt;.
  Diagnostic functions are included to compare weights and weighted estimates
  from different sets of replicate weights.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/bootstrap-replicates.html">Bootstrap Methods for Surveys</a>
    <a class="dropdown-item" href="articles/nonresponse-adjustments.html">Nonresponse Adjustments</a>
    <a class="dropdown-item" href="articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a>
    <a class="dropdown-item" href="articles/two-phase-sampling.html">Replication Methods for Two-phase Sampling</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="svrep">svrep<a class="anchor" aria-label="anchor" href="#svrep"></a>
</h1></div>
<!-- badges: start -->

<p>svrep provides methods for creating, updating, and analyzing replicate weights for surveys. Functions from svrep can be used to implement adjustments to replicate designs (e.g. nonresponse weighting class adjustments) and analyze their effect on the replicate weights and on estimates of interest. Facilitates the creation of bootstrap and generalized bootstrap replicate weights.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of svrep from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"svrep"</span><span class="op">)</span></span></code></pre></div>
<p>You can install the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"bschneidr/svrep"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>When using the ‘svrep’ package, please make sure to cite it in any resulting publications. This is appreciated by the package maintainer and helps to incentivize ongoing development, maintenance, and support.</p>
<blockquote>
<p>Schneider B. (2023). “svrep: Tools for Creating, Updating, and Analyzing Survey Replicate Weights”. R package version 0.6.0.</p>
</blockquote>
<p>When using the ‘svrep’ package, please also cite the ‘survey’ package and R itself, since they are essential to the use of ‘svrep’. Call <code>citation('svrep')</code>, <code>citation('survey')</code>, and <code>citation('base')</code> for more information and to generate BibTex entries for citing these packages as well as R.</p>
</div>
<div class="section level2">
<h2 id="example-usage">Example usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h2>
<div class="section level3">
<h3 id="creating-replicate-weights">Creating replicate weights<a class="anchor" aria-label="anchor" href="#creating-replicate-weights"></a>
</h3>
<p>Suppose we have data from a survey selected using a complex sampling method such as cluster sampling. To represent the complex survey design, we can create a survey design object using the survey package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bschneidr.github.io/svrep/">svrep</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span>, package <span class="op">=</span> <span class="st">"survey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a survey design object for a sample</span></span>
<span><span class="co"># selected using a single-stage cluster sample without replacement</span></span>
<span><span class="va">dclus1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">apiclus1</span>,</span>
<span>                    id <span class="op">=</span> <span class="op">~</span><span class="va">dnum</span>, weights <span class="op">=</span> <span class="op">~</span><span class="va">pw</span>, fpc <span class="op">=</span> <span class="op">~</span><span class="va">fpc</span><span class="op">)</span></span></code></pre></div>
<p>To help us estimate sampling variances, we can create bootstrap replicate weights. The function <code><a href="reference/as_bootstrap_design.html">as_bootstrap_design()</a></code> creates bootstrap replicate weights appropriate to common complex sampling designs, using bootstrapping methods from the ‘survey’ package as well as additional methods such as the Rao-Wu-Yue-Beaumont method (a generalization of the Rao-Wu bootstrap).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create replicate-weights survey design</span></span>
<span><span class="va">orig_rep_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/as_bootstrap_design.html">as_bootstrap_design</a></span><span class="op">(</span><span class="va">dclus1</span>, replicates <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                                       type <span class="op">=</span> <span class="st">"Rao-Wu-Yue-Beaumont"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">orig_rep_design</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call: as_bootstrap_design(dclus1, replicates = 500, type = "Rao-Wu-Yue-Beaumont")</span></span>
<span><span class="co">#&gt; Survey bootstrap with 500 replicates.</span></span></code></pre></div>
<p>For especially complex survey designs (e.g., systematic samples), the generalized survey bootstrap can be used.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load example data for a stratified systematic sample</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'library_stsys_sample'</span>, package <span class="op">=</span> <span class="st">'svrep'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First, ensure data are sorted in same order as was used in sampling</span></span>
<span><span class="va">library_stsys_sample</span> <span class="op">&lt;-</span> <span class="va">library_stsys_sample</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">library_stsys_sample</span><span class="op">$</span><span class="va">SAMPLING_SORT_ORDER</span><span class="op">)</span>,</span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create a survey design object</span></span>
<span><span class="va">design_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">library_stsys_sample</span>,</span>
<span>  strata <span class="op">=</span> <span class="op">~</span> <span class="va">SAMPLING_STRATUM</span>,</span>
<span>  ids <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  fpc <span class="op">=</span> <span class="op">~</span> <span class="va">STRATUM_POP_SIZE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to generalized bootstrap replicate design</span></span>
<span><span class="va">gen_boot_design_sd2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/as_gen_boot_design.html">as_gen_boot_design</a></span><span class="op">(</span></span>
<span>  design <span class="op">=</span> <span class="va">design_obj</span>,</span>
<span>  variance_estimator <span class="op">=</span> <span class="st">"SD2"</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; For `variance_estimator='SD2', assumes rows of data are sorted in the same order used in sampling.</span></span></code></pre></div>
<p>For relatively simple designs, we can also use the random-groups jackknife.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create random-group jackknife replicates</span></span>
<span><span class="co"># for a single-stage survey with many first-stage sampling units</span></span>
<span><span class="va">rand_grp_jk_design</span> <span class="op">&lt;-</span> <span class="va">apisrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">_</span>, ids <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="op">~</span> <span class="va">pw</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/as_random_group_jackknife_design.html">as_random_group_jackknife_design</a></span><span class="op">(</span></span>
<span>    replicates <span class="op">=</span> <span class="fl">20</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adjusting-for-non-response-or-unknown-eligibility">Adjusting for non-response or unknown eligibility<a class="anchor" aria-label="anchor" href="#adjusting-for-non-response-or-unknown-eligibility"></a>
</h3>
<p>In social surveys, unit nonresponse is extremely common. It is also somewhat common for respondent cases to be classified as “ineligible” for the survey based on their response. In general, sampled cases are typically classified as “respondents”, “nonrespondents”, “ineligible cases”, and “unknown eligibility” cases.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create variable giving response status</span></span>
<span><span class="va">orig_rep_design</span><span class="op">$</span><span class="va">variables</span><span class="op">[[</span><span class="st">'response_status'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Respondent"</span>, <span class="st">"Nonrespondent"</span>,</span>
<span>        <span class="st">"Ineligible"</span>, <span class="st">"Unknown eligibility"</span><span class="op">)</span>,</span>
<span>  prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">orig_rep_design</span><span class="op">)</span>,</span>
<span>  replace <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">orig_rep_design</span><span class="op">$</span><span class="va">variables</span><span class="op">$</span><span class="va">response_status</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Ineligible       Nonrespondent          Respondent Unknown eligibility </span></span>
<span><span class="co">#&gt;                  16                  32                 119                  16</span></span></code></pre></div>
<p>It is common practice to adjust weights when there is non-response or there are sampled cases whose eligibility for the survey is unknown. The most common form of adjustment is “weight redistribution”: for example, weights from non-respondents are reduced to zero, and weights from respondents are correspondingly increased so that the total weight in the sample is unchanged. In order to account for these adjustments when estimating variances for survey statistics, the adjustments are repeated separately for each set of replicate weights. This process can be easily implemented using the <code><a href="reference/redistribute_weights.html">redistribute_weights()</a></code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Adjust weights for unknown eligibility</span></span>
<span><span class="va">ue_adjusted_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redistribute_weights.html">redistribute_weights</a></span><span class="op">(</span></span>
<span>  design <span class="op">=</span> <span class="va">orig_rep_design</span>,</span>
<span>  reduce_if <span class="op">=</span> <span class="va">response_status</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Unknown eligibility"</span><span class="op">)</span>,</span>
<span>  increase_if <span class="op">=</span> <span class="op">!</span><span class="va">response_status</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Unknown eligibility"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>By supplying column names to the <code>by</code> argument of <code><a href="reference/redistribute_weights.html">redistribute_weights()</a></code>, adjustments are conducted separately in different groups. This can be used to conduct nonresponse weighting class adjustments.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nr_adjusted_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redistribute_weights.html">redistribute_weights</a></span><span class="op">(</span></span>
<span>  design <span class="op">=</span> <span class="va">ue_adjusted_design</span>,</span>
<span>  reduce_if <span class="op">=</span> <span class="va">response_status</span> <span class="op">==</span> <span class="st">"Nonrespondent"</span>,</span>
<span>  increase_if <span class="op">=</span> <span class="va">response_status</span> <span class="op">==</span> <span class="st">"Respondent"</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stype"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparing-estimates-from-different-sets-of-weights">Comparing estimates from different sets of weights<a class="anchor" aria-label="anchor" href="#comparing-estimates-from-different-sets-of-weights"></a>
</h3>
<p>In order to assess whether weighting adjustments have an impact on the estimates we care about, we want to compare the estimates from the different sets of weights. The function <code><a href="reference/svyby_repwts.html">svyby_repwts()</a></code> makes it easy to compare estimates from different sets of weights.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate overall means (and their standard errors) from each design</span></span>
<span><span class="va">overall_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/svyby_repwts.html">svyby_repwts</a></span><span class="op">(</span></span>
<span>  rep_designs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'original'</span> <span class="op">=</span> <span class="va">orig_rep_design</span>,</span>
<span>                     <span class="st">'nonresponse-adjusted'</span> <span class="op">=</span> <span class="va">nr_adjusted_design</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="op">~</span> <span class="va">api00</span>, FUN <span class="op">=</span> <span class="va">svymean</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">overall_estimates</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;           Design_Name    api00       se</span></span>
<span><span class="co">#&gt;  nonresponse-adjusted 641.2030 25.54368</span></span>
<span><span class="co">#&gt;              original 644.1694 23.06284</span></span>
<span></span>
<span><span class="co"># Estimate domain means (and their standard errors) from each design</span></span>
<span><span class="va">domain_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/svyby_repwts.html">svyby_repwts</a></span><span class="op">(</span></span>
<span>  rep_designs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'original'</span> <span class="op">=</span> <span class="va">orig_rep_design</span>,</span>
<span>                     <span class="st">'nonresponse-adjusted'</span> <span class="op">=</span> <span class="va">nr_adjusted_design</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="op">~</span> <span class="va">api00</span>, by <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span>, FUN <span class="op">=</span> <span class="va">svymean</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">domain_estimates</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;           Design_Name stype    api00       se</span></span>
<span><span class="co">#&gt;  nonresponse-adjusted     E 649.9188 25.56366</span></span>
<span><span class="co">#&gt;              original     E 648.8681 22.31347</span></span>
<span><span class="co">#&gt;  nonresponse-adjusted     H 603.5390 45.26079</span></span>
<span><span class="co">#&gt;              original     H 618.5714 37.39448</span></span>
<span><span class="co">#&gt;  nonresponse-adjusted     M 616.3260 36.27983</span></span>
<span><span class="co">#&gt;              original     M 631.4400 31.03957</span></span></code></pre></div>
<p>We can even test for differences in estimates from the two sets of weights and calculate confidence intervals for their difference.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/svyby_repwts.html">svyby_repwts</a></span><span class="op">(</span></span>
<span>  rep_designs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'original'</span> <span class="op">=</span> <span class="va">orig_rep_design</span>,</span>
<span>                     <span class="st">'nonresponse-adjusted'</span> <span class="op">=</span> <span class="va">nr_adjusted_design</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="op">~</span> <span class="va">api00</span>, FUN <span class="op">=</span> <span class="va">svymean</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      nonresponse-adjusted original</span></span>
<span><span class="co">#&gt; nonresponse-adjusted             652.4793 585.5253</span></span>
<span><span class="co">#&gt; original                         585.5253 531.8947</span></span>
<span></span>
<span><span class="va">diff_between_ests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svycontrast.html" class="external-link">svycontrast</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="va">estimates</span>,</span>
<span>                                 contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                                   <span class="st">"Original vs. Adjusted"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>                                 <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">diff_between_ests</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       contrast     SE</span></span>
<span><span class="co">#&gt; Original vs. Adjusted   2.9664 3.6501</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">diff_between_ests</span><span class="op">)</span></span>
<span><span class="co">#&gt;                           2.5 %   97.5 %</span></span>
<span><span class="co">#&gt; Original vs. Adjusted -4.187705 10.12056</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="diagnosing-potential-issues-with-weights">Diagnosing potential issues with weights<a class="anchor" aria-label="anchor" href="#diagnosing-potential-issues-with-weights"></a>
</h3>
<p>When adjusting replicate weights, there are several diagnostics which can be used to ensure that the adjustments were carried out correctly and that they do more good than harm. The function <code><a href="reference/summarize_rep_weights.html">summarize_rep_weights()</a></code> helps by allowing you to quickly summarize the replicate weights.</p>
<p>For example, when carrying out nonresponse adjustments, we might want to verify that all of the weights for nonrespondents have been set to zero in each replicate. We can use the <code><a href="reference/summarize_rep_weights.html">summarize_rep_weights()</a></code> to compare summary statistics for each replicate, and we can use its <code>by</code> argument to group the summaries by one or more variables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/summarize_rep_weights.html">summarize_rep_weights</a></span><span class="op">(</span></span>
<span>  rep_design <span class="op">=</span> <span class="va">nr_adjusted_design</span>,</span>
<span>  type <span class="op">=</span> <span class="st">'specific'</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"response_status"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Rep_Column</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;          response_status Rep_Column   N N_NONZERO       SUM     MEAN        CV</span></span>
<span><span class="co">#&gt; 1             Ineligible          1  16        16  608.1360 38.00850 1.2415437</span></span>
<span><span class="co">#&gt; 2             Ineligible          2  16        16  739.2634 46.20397 0.7578107</span></span>
<span><span class="co">#&gt; 501        Nonrespondent          1  32         0    0.0000  0.00000       NaN</span></span>
<span><span class="co">#&gt; 502        Nonrespondent          2  32         0    0.0000  0.00000       NaN</span></span>
<span><span class="co">#&gt; 1001          Respondent          1 119       119 6236.0577 52.40385 1.0431318</span></span>
<span><span class="co">#&gt; 1002          Respondent          2 119       119 6426.4544 54.00382 0.8345243</span></span>
<span><span class="co">#&gt; 1501 Unknown eligibility          1  16         0    0.0000  0.00000       NaN</span></span>
<span><span class="co">#&gt; 1502 Unknown eligibility          2  16         0    0.0000  0.00000       NaN</span></span>
<span><span class="co">#&gt;            MIN       MAX</span></span>
<span><span class="co">#&gt; 1    0.5632079 120.38814</span></span>
<span><span class="co">#&gt; 2    0.5422029  77.44622</span></span>
<span><span class="co">#&gt; 501  0.0000000   0.00000</span></span>
<span><span class="co">#&gt; 502  0.0000000   0.00000</span></span>
<span><span class="co">#&gt; 1001 0.6072282 151.10496</span></span>
<span><span class="co">#&gt; 1002 0.5971008 102.40567</span></span>
<span><span class="co">#&gt; 1501 0.0000000   0.00000</span></span>
<span><span class="co">#&gt; 1502 0.0000000   0.00000</span></span></code></pre></div>
<p>At the end of the adjustment process, we can inspect the number of rows and columns and examine the variability of the weights across all of the replicates.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nr_adjusted_design</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">response_status</span> <span class="op">==</span> <span class="st">"Respondent"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/summarize_rep_weights.html">summarize_rep_weights</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">'overall'</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt;   nrows ncols degf_svy_pkg rank avg_wgt_sum sd_wgt_sums min_rep_wgt max_rep_wgt</span></span>
<span><span class="co">#&gt; 1   119   500           29   30    5625.555    1257.982   0.5305136     367.826</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sample-based-calibration">Sample-based calibration<a class="anchor" aria-label="anchor" href="#sample-based-calibration"></a>
</h3>
<p>When we rake or poststratify to estimated control totals rather than to “true” population values, we may need to account for the variance of the estimated control totals to ensure that calibrated estimates appropriately reflect sampling error of both the primary survey of interest and the survey from which the control totals were estimated. The ‘svrep’ package provides two functions which accomplish this. The function <code><a href="reference/calibrate_to_estimate.html">calibrate_to_estimate()</a></code> requires the user to supply a vector of control totals and its variance-covariance matrix, while the function <code><a href="reference/calibrate_to_sample.html">calibrate_to_sample()</a></code> requires the user to supply a dataset with replicate weights to use for estimating control totals and their sampling variance.</p>
<p>As an example, suppose we have a survey measuring vaccination status of adults in Louisville, Kentucky. For variance estimation, we use 100 bootstrap replicates.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lou_vax_survey"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load example data</span></span>
<span><span class="va">lou_vax_survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="op">~</span> <span class="va">SAMPLING_WEIGHT</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">lou_vax_survey</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/as_bootstrap_design.html">as_bootstrap_design</a></span><span class="op">(</span>replicates <span class="op">=</span> <span class="fl">100</span>, mse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Adjust for nonresponse</span></span>
<span><span class="va">lou_vax_survey</span> <span class="op">&lt;-</span> <span class="va">lou_vax_survey</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/redistribute_weights.html">redistribute_weights</a></span><span class="op">(</span></span>
<span>    reduce_if <span class="op">=</span> <span class="va">RESPONSE_STATUS</span> <span class="op">==</span> <span class="st">"Nonrespondent"</span>,</span>
<span>    increase_if <span class="op">=</span> <span class="va">RESPONSE_STATUS</span> <span class="op">==</span> <span class="st">"Respondent"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">RESPONSE_STATUS</span> <span class="op">==</span> <span class="st">"Respondent"</span><span class="op">)</span></span></code></pre></div>
<p>To reduce nonresponse bias or coverage error for the survey, we can rake the survey to population totals for demographic groups estimated by the Census Bureau in the American Community Survey (ACS). To estimate the population totals for raking purposes, we can use microdata with replicate weights.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load microdata to use for estimating control totals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lou_pums_microdata"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">acs_benchmark_survey</span> <span class="op">&lt;-</span> <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svrepdesign.html" class="external-link">svrepdesign</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">lou_pums_microdata</span>,</span>
<span>  variables <span class="op">=</span> <span class="op">~</span> <span class="va">UNIQUE_ID</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE_ETHNICITY</span> <span class="op">+</span> <span class="va">EDUC_ATTAINMENT</span>,</span>
<span>  weights <span class="op">=</span> <span class="op">~</span> <span class="va">PWGTP</span>, repweights <span class="op">=</span> <span class="st">"PWGTP\\d{1,2}"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"successive-difference"</span>,</span>
<span>  mse <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can see that the distribution of race/ethnicity among respondents differs from the distribution of race/ethnicity in the ACS benchmarks.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare demographic estimates from the two data sources</span></span>
<span><span class="va">estimate_comparisons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">'Vax_Survey'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">RACE_ETHNICITY</span>, design <span class="op">=</span> <span class="va">lou_vax_survey</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="st">'ACS_Benchmark'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">RACE_ETHNICITY</span>, design <span class="op">=</span> <span class="va">acs_benchmark_survey</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">estimate_comparisons</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">estimate_comparisons</span><span class="op">)</span>,</span>
<span>                                       <span class="st">"RACE_ETHNICITY"</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">estimate_comparisons</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                         Vax_Survey</span></span>
<span><span class="co">#&gt; Black or African American alone, not Hispanic or Latino 0.16932271</span></span>
<span><span class="co">#&gt; Hispanic or Latino                                      0.03386454</span></span>
<span><span class="co">#&gt; Other Race, not Hispanic or Latino                      0.05776892</span></span>
<span><span class="co">#&gt; White alone, not Hispanic or Latino                     0.73904382</span></span>
<span><span class="co">#&gt;                                                         ACS_Benchmark</span></span>
<span><span class="co">#&gt; Black or African American alone, not Hispanic or Latino    0.19949824</span></span>
<span><span class="co">#&gt; Hispanic or Latino                                         0.04525039</span></span>
<span><span class="co">#&gt; Other Race, not Hispanic or Latino                         0.04630955</span></span>
<span><span class="co">#&gt; White alone, not Hispanic or Latino                        0.70894182</span></span></code></pre></div>
<p>There are two options for calibrating the sample to the control totals from the benchmark survey. With the first approach, we supply point estimates and their variance-covariance matrix to the function <code><a href="reference/calibrate_to_estimate.html">calibrate_to_estimate()</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate control totals and their variance-covariance matrix</span></span>
<span><span class="va">control_totals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">RACE_ETHNICITY</span> <span class="op">+</span> <span class="va">EDUC_ATTAINMENT</span>,</span>
<span>                          design <span class="op">=</span> <span class="va">acs_benchmark_survey</span><span class="op">)</span></span>
<span><span class="va">point_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">control_totals</span><span class="op">)</span></span>
<span><span class="va">vcov_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">control_totals</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calibrate the vaccination survey to the estimated control totals</span></span>
<span><span class="va">vax_survey_raked_to_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calibrate_to_estimate.html">calibrate_to_estimate</a></span><span class="op">(</span></span>
<span>  rep_design <span class="op">=</span> <span class="va">lou_vax_survey</span>,</span>
<span>  estimate <span class="op">=</span> <span class="va">point_estimates</span>,</span>
<span>  vcov_estimate <span class="op">=</span> <span class="va">vcov_estimates</span>,</span>
<span>  cal_formula <span class="op">=</span> <span class="op">~</span> <span class="va">RACE_ETHNICITY</span> <span class="op">+</span> <span class="va">EDUC_ATTAINMENT</span>,</span>
<span>  calfun <span class="op">=</span> <span class="fu">survey</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.raking</a></span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>With the second approach, we supply the control survey’s replicate design to <code><a href="reference/calibrate_to_sample.html">calibrate_to_sample()</a></code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vax_survey_raked_to_acs_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calibrate_to_sample.html">calibrate_to_sample</a></span><span class="op">(</span></span>
<span>  primary_rep_design <span class="op">=</span> <span class="va">lou_vax_survey</span>,</span>
<span>  control_rep_design <span class="op">=</span> <span class="va">acs_benchmark_survey</span>,</span>
<span>  cal_formula <span class="op">=</span> <span class="op">~</span> <span class="va">RACE_ETHNICITY</span> <span class="op">+</span> <span class="va">EDUC_ATTAINMENT</span>,</span>
<span>  calfun <span class="op">=</span> <span class="fu">survey</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.raking</a></span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After calibration, we can see that the estimated vaccination rate has decreased, and the estimated standard error of the estimated vaccination rate has increased.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare the two sets of estimates</span></span>
<span><span class="fu"><a href="reference/svyby_repwts.html">svyby_repwts</a></span><span class="op">(</span></span>
<span>  rep_design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">'NR-adjusted'</span> <span class="op">=</span> <span class="va">lou_vax_survey</span>,</span>
<span>    <span class="st">'Raked to estimate'</span> <span class="op">=</span> <span class="va">vax_survey_raked_to_estimates</span>,</span>
<span>    <span class="st">'Raked to sample'</span> <span class="op">=</span> <span class="va">vax_survey_raked_to_acs_sample</span></span>
<span>  <span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="op">~</span> <span class="va">VAX_STATUS</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">svymean</span>,</span>
<span>  keep.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;         Design_Name VAX_STATUSUnvaccinated VAX_STATUSVaccinated        se1</span></span>
<span><span class="co">#&gt; 1       NR-adjusted              0.4621514            0.5378486 0.01863299</span></span>
<span><span class="co">#&gt; 2 Raked to estimate              0.4732623            0.5267377 0.01895171</span></span>
<span><span class="co">#&gt; 3   Raked to sample              0.4732623            0.5267377 0.01893093</span></span>
<span><span class="co">#&gt;          se2</span></span>
<span><span class="co">#&gt; 1 0.01863299</span></span>
<span><span class="co">#&gt; 2 0.01895171</span></span>
<span><span class="co">#&gt; 3 0.01893093</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="saving-results-to-a-data-file">Saving results to a data file<a class="anchor" aria-label="anchor" href="#saving-results-to-a-data-file"></a>
</h3>
<p>Once we’re satisfied with the weights, we can create a data frame with the analysis variables and columns of final full-sample weights and replicate weights. This format is easy to export to data files that can be loaded into R or other software later.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_frame_with_final_weights</span> <span class="op">&lt;-</span> <span class="va">vax_survey_raked_to_estimates</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/as_data_frame_with_weights.html">as_data_frame_with_weights</a></span><span class="op">(</span></span>
<span>    full_wgt_name <span class="op">=</span> <span class="st">"RAKED_WGT"</span>,</span>
<span>    rep_wgt_prefix <span class="op">=</span> <span class="st">"RAKED_REP_WGT_"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview first 10 column names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data_frame_with_final_weights</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "RESPONSE_STATUS" "RACE_ETHNICITY"  "SEX"             "EDUC_ATTAINMENT"</span></span>
<span><span class="co">#&gt;  [5] "VAX_STATUS"      "SAMPLING_WEIGHT" "RAKED_WGT"       "RAKED_REP_WGT_1"</span></span>
<span><span class="co">#&gt;  [9] "RAKED_REP_WGT_2" "RAKED_REP_WGT_3"</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Write the data to a CSV file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">data_frame_with_final_weights</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"survey-data_with-updated-weights.csv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=svrep" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/bschneidr/svrep/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/bschneidr/svrep/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing svrep</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ben Schneider <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0406-8470" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=svrep" class="external-link"><img src="https://www.r-pkg.org/badges/version/svrep" alt="CRAN status"></a></li>
<li><a href="https://app.codecov.io/gh/bschneidr/svrep?branch=main" class="external-link"><img src="https://codecov.io/gh/bschneidr/svrep/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
