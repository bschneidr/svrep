<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Converts a survey design object to a replicate design object
with replicate weights formed using the generalized bootstrap method.
The generalized survey bootstrap is a method for forming bootstrap replicate weights
from a textbook variance estimator, provided that the variance estimator
can be represented as a quadratic form whose matrix is positive semidefinite
(this covers a large class of variance estimators)."><title>Convert a survey design object to a generalized boostrap replicate design — as_gen_boot_design • svrep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert a survey design object to a generalized boostrap replicate design — as_gen_boot_design"><meta property="og:description" content="Converts a survey design object to a replicate design object
with replicate weights formed using the generalized bootstrap method.
The generalized survey bootstrap is a method for forming bootstrap replicate weights
from a textbook variance estimator, provided that the variance estimator
can be represented as a quadratic form whose matrix is positive semidefinite
(this covers a large class of variance estimators)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/bootstrap-replicates.html">Bootstrap Methods for Surveys</a>
    <a class="dropdown-item" href="../articles/nonresponse-adjustments.html">Nonresponse Adjustments</a>
    <a class="dropdown-item" href="../articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a>
    <a class="dropdown-item" href="../articles/two-phase-sampling.html">Replication Methods for Two-phase Sampling</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Convert a survey design object to a generalized boostrap replicate design</h1>
      <small class="dont-index">Source: <a href="https://github.com/bschneidr/svrep/blob/HEAD/R/generalized_bootstrap.R" class="external-link"><code>R/generalized_bootstrap.R</code></a></small>
      <div class="d-none name"><code>as_gen_boot_design.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Converts a survey design object to a replicate design object
with replicate weights formed using the generalized bootstrap method.
The generalized survey bootstrap is a method for forming bootstrap replicate weights
from a textbook variance estimator, provided that the variance estimator
can be represented as a quadratic form whose matrix is positive semidefinite
(this covers a large class of variance estimators).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">as_gen_boot_design</span><span class="op">(</span></span>
<span>  <span class="va">design</span>,</span>
<span>  variance_estimator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  tau <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  psd_option <span class="op">=</span> <span class="st">"warn"</span>,</span>
<span>  mse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"survey.replicates.mse"</span><span class="op">)</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>design</dt>
<dd><p>A survey design object created using the 'survey' (or 'srvyr') package,
with class <code>'survey.design'</code> or <code>'svyimputationList'</code>.</p></dd>


<dt>variance_estimator</dt>
<dd><p>The name of the variance estimator
whose quadratic form matrix should be created. See the section "Variance Estimators" below.
Options include:</p><ul><li><p><strong>"Yates-Grundy"</strong>: The Yates-Grundy variance estimator based on
  first-order and second-order inclusion probabilities.</p></li>
<li><p><strong>"Horvitz-Thompson"</strong>: The Horvitz-Thompson variance estimator based on
  first-order and second-order inclusion probabilities.</p></li>
<li><p><strong>"Poisson Horvitz-Thompson"</strong>: The Horvitz-Thompson variance estimator
  based on assuming Poisson sampling, with first-order inclusion probabilities
  inferred from the sampling probabilities of the survey design object.</p></li>
<li><p><strong>"Stratified Multistage SRS"</strong>: The usual stratified multistage variance estimator
  based on estimating the variance of cluster totals within strata at each stage.</p></li>
<li><p><strong>"Ultimate Cluster"</strong>: The usual variance estimator based on estimating
  the variance of first-stage cluster totals within first-stage strata.</p></li>
<li><p><strong>"SD1"</strong>: The non-circular successive-differences variance estimator described by Ash (2014),
  sometimes used for variance estimation for systematic sampling.</p></li>
<li><p><strong>"SD2"</strong>: The circular successive-differences variance estimator described by Ash (2014).
  This estimator is the basis of the "successive-differences replication" estimator commonly used
  for variance estimation for systematic sampling.</p></li>
</ul></dd>


<dt>replicates</dt>
<dd><p>Number of bootstrap replicates (should be as large as possible, given computer memory/storage limitations).
A commonly-recommended default is 500.</p></dd>


<dt>tau</dt>
<dd><p>Either <code>"auto"</code>, or a single number. This is the rescaling constant
used to avoid negative weights through the transformation \(\frac{w + \tau - 1}{\tau}\),
where \(w\) is the original weight and \(\tau\) is the rescaling constant <code>tau</code>. <br>
If <code>tau="auto"</code>, the rescaling factor is determined automatically as follows:
if all of the adjustment factors are nonnegative, then <code>tau</code> is set equal to 1;
otherwise, <code>tau</code> is set to the smallest value needed to rescale
the adjustment factors such that they are all at least <code>0.01</code>.</p></dd>


<dt>psd_option</dt>
<dd><p>Either <code>"warn"</code> (the default) or <code>"error"</code>.
This option specifies what will happen if the target variance estimator
has a quadratic form matrix which is not positive semidefinite. This
can occasionally happen, particularly for two-phase designs. <br>
If <code>psd_option="error"</code>, then an error message will be displayed. <br>
If <code>psd_option="warn"</code>, then a warning message will be displayed,
and the quadratic form matrix will be approximated by the most similar
positive semidefinite matrix.
This approximation was suggested by Beaumont and Patak (2012),
who note that this is conservative in the sense of producing
overestimates of variance.
Beaumont and Patak (2012) argue that this overestimation is expected to be
small in magnitude. See <code><a href="get_nearest_psd_matrix.html">get_nearest_psd_matrix</a></code>
for details of the approximation.</p></dd>


<dt>mse</dt>
<dd><p>If <code>TRUE</code>, compute variances from sums of squares around the point estimate from the full-sample weights,
If <code>FALSE</code>, compute variances from sums of squares around the mean estimate from the replicate weights.</p></dd>


<dt>compress</dt>
<dd><p>This reduces the computer memory required to represent the replicate weights and has no
impact on estimates.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A replicate design object, with class <code>svyrep.design</code>, which can be used with the usual functions,
such as <code><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean()</a></code> or <code><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">svyglm()</a></code>. <br></p>
<p></p>
<p><br></p>


<p>Use <code>weights(..., type = 'analysis')</code> to extract the matrix of replicate weights. <br></p>


<p>Use <code><a href="as_data_frame_with_weights.html">as_data_frame_with_weights()</a></code> to convert the design object to a data frame with columns
for the full-sample and replicate weights.</p>
    </div>
    <div class="section level2">
    <h2 id="statistical-details">Statistical Details<a class="anchor" aria-label="anchor" href="#statistical-details"></a></h2>
    

<p>Let \(v( \hat{T_y})\) be the textbook variance estimator for an estimated population total \(\hat{T}_y\) of some variable \(y\).
The base weight for case \(i\) in our sample is \(w_i\), and we let \(\breve{y}_i\) denote the weighted value \(w_iy_i\).
Suppose we can represent our textbook variance estimator as a quadratic form: \(v(\hat{T}_y) = \breve{y}\Sigma\breve{y}^T\),
for some \(n \times n\) matrix \(\Sigma\).
The only constraint on \(\Sigma\) is that, for our sample, it must be symmetric and positive semidefinite.</p>
<p>The bootstrapping process creates \(B\) sets of replicate weights, where the \(b\)-th set of replicate weights is a vector of length \(n\) denoted \(\mathbf{a}^{(b)}\), whose \(k\)-th value is denoted \(a_k^{(b)}\).
This yields \(B\) replicate estimates of the population total, \(\hat{T}_y^{*(b)}=\sum_{k \in s} a_k^{(b)} \breve{y}_k\), for \(b=1, \ldots B\), which can be used to estimate sampling variance.</p>
<p>$$
  v_B\left(\hat{T}_y\right)=\frac{\sum_{b=1}^B\left(\hat{T}_y^{*(b)}-\hat{T}_y\right)^2}{B}
$$</p>
<p>This bootstrap variance estimator can be written as a quadratic form:</p>
<p>$$
    v_B\left(\hat{T}_y\right) =\mathbf{\breve{y}}^{\prime}\Sigma_B \mathbf{\breve{y}}
  $$
  where
  $$
    \boldsymbol{\Sigma}_B = \frac{\sum_{b=1}^B\left(\mathbf{a}^{(b)}-\mathbf{1}_n\right)\left(\mathbf{a}^{(b)}-\mathbf{1}_n\right)^{\prime}}{B}
  $$</p>
<p>Note that if the vector of adjustment factors \(\mathbf{a}^{(b)}\) has expectation \(\mathbf{1}_n\) and variance-covariance matrix \(\boldsymbol{\Sigma}\),
then we have the bootstrap expectation \(E_{*}\left( \boldsymbol{\Sigma}_B \right) = \boldsymbol{\Sigma}\). Since the bootstrap process takes the sample values \(\breve{y}\) as fixed, the bootstrap expectation of the variance estimator is \(E_{*} \left( \mathbf{\breve{y}}^{\prime}\Sigma_B \mathbf{\breve{y}}\right)= \mathbf{\breve{y}}^{\prime}\Sigma \mathbf{\breve{y}}\).
Thus, we can produce a bootstrap variance estimator with the same expectation as the textbook variance estimator simply by randomly generating \(\mathbf{a}^{(b)}\) from a distribution with the following two conditions:
<br><strong>Condition 1</strong>: \(\quad \mathbf{E}_*(\mathbf{a})=\mathbf{1}_n\)
<br><strong>Condition 2</strong>: \(\quad \mathbf{E}_*\left(\mathbf{a}-\mathbf{1}_n\right)\left(\mathbf{a}-\mathbf{1}_n\right)^{\prime}=\mathbf{\Sigma}\)
<br><br>
While there are multiple ways to generate adjustment factors satisfying these conditions,
the simplest general method is to simulate from a multivariate normal distribution: \(\mathbf{a} \sim MVN(\mathbf{1}_n, \boldsymbol{\Sigma})\).
This is the method used by this function.</p>
    </div>
    <div class="section level2">
    <h2 id="details-on-rescaling-to-avoid-negative-adjustment-factors">Details on Rescaling to Avoid Negative Adjustment Factors<a class="anchor" aria-label="anchor" href="#details-on-rescaling-to-avoid-negative-adjustment-factors"></a></h2>
    

<p>Let \(\mathbf{A} = \left[ \mathbf{a}^{(1)} \cdots \mathbf{a}^{(b)} \cdots \mathbf{a}^{(B)} \right]\) denote the \((n \times B)\) matrix of bootstrap adjustment factors.
To eliminate negative adjustment factors, Beaumont and Patak (2012) propose forming a rescaled matrix of nonnegative replicate factors \(\mathbf{A}^S\) by rescaling each adjustment factor \(a_k^{(b)}\) as follows:
$$
   a_k^{S,(b)} = \frac{a_k^{(b)} + \tau - 1}{\tau}
 $$
where \(\tau \geq 1 - a_k^{(b)} \geq 1\) for all \(k\) in \(\left\{ 1,\ldots,n \right\}\) and all \(b\) in \(\left\{1, \ldots, B\right\}\).</p>
<p>The value of \(\tau\) can be set based on the realized adjustment factor matrix \(\mathbf{A}\) or by choosing \(\tau\) prior to generating the adjustment factor matrix \(\mathbf{A}\) so that \(\tau\) is likely to be large enough to prevent negative bootstrap weights.</p>
<p>If the adjustment factors are rescaled in this manner, it is important to adjust the scale factor used in estimating the variance with the bootstrap replicates, which becomes \(\frac{\tau^2}{B}\) instead of \(\frac{1}{B}\).
$$
 \textbf{Prior to rescaling: } v_B\left(\hat{T}_y\right) = \frac{1}{B}\sum_{b=1}^B\left(\hat{T}_y^{*(b)}-\hat{T}_y\right)^2
 $$
$$
 \textbf{After rescaling: } v_B\left(\hat{T}_y\right) = \frac{\tau^2}{B}\sum_{b=1}^B\left(\hat{T}_y^{S*(b)}-\hat{T}_y\right)^2
$$
When sharing a dataset that uses rescaled weights from a generalized survey bootstrap, the documentation for the dataset should instruct the user to use replication scale factor \(\frac{\tau^2}{B}\) rather than \(\frac{1}{B}\) when estimating sampling variances.</p>
    </div>
    <div class="section level2">
    <h2 id="variance-estimators">Variance Estimators<a class="anchor" aria-label="anchor" href="#variance-estimators"></a></h2>
    

<p>The <strong>Horvitz-Thompson</strong> variance estimator:
$$
  v(\hat{Y}) = \sum_{i \in s}\sum_{j \in s} (1 - \frac{\pi_i \pi_j}{\pi_{ij}}) \frac{y_i}{\pi_i} \frac{y_j}{\pi_j}
$$
The <strong>Poisson Horvitz-Thompson</strong> variance estimator
is simply the Horvitz-Thompson variance estimator, but
where \(\pi_{ij}=\pi_i \times \pi_j\), which is the case for Poisson sampling. <br><br>
The <strong>Yates-Grundy</strong> variance estimator:
$$
  v(\hat{Y}) = -\frac{1}{2}\sum_{i \in s}\sum_{j \in s} (1 - \frac{\pi_i \pi_j}{\pi_{ij}}) (\frac{y_i}{\pi_i} - \frac{y_j}{\pi_j})^2
$$
The <strong>Stratified Multistage SRS</strong> variance estimator is the recursive variance estimator
proposed by Bellhouse (1985) and used in the 'survey' package's function <a href="https://rdrr.io/pkg/survey/man/svyrecvar.html" class="external-link">svyrecvar</a>.
The estimator can be used for any number of sampling stages. For illustration, we describe its use
for two sampling stages.
$$
  v(\hat{Y}) = \hat{V}_1 + \hat{V}_2
$$
where
$$
  \hat{V}_1 = \sum_{h=1}^{H} (1 - \frac{n_h}{N_h})\frac{n_h}{n_h - 1} \sum_{i=1}^{n_h} (y_{hi.} - \bar{y}_{hi.})^2
$$
and
$$
  \hat{V}_2 = \sum_{h=1}^{H} \frac{n_h}{N_h} \sum_{i=1}^{n_h}v_{hi}(y_{hi.})
$$
where \(n_h\) is the number of sampled clusters in stratum \(h\),
\(N_h\) is the number of population clusters in stratum \(h\),
\(y_{hi.}\) is the weighted cluster total in cluster \(i\) of stratum \(h\),
\(\bar{y}_{hi.}\) is the mean weighted cluster total of stratum \(h\),
(\(\bar{y}_{hi.} = \frac{1}{n_h}\sum_{i=1}^{n_h}y_{hi.}\)), and
\(v_{hi}(y_{hi.})\) is the estimated sampling variance of \(y_{hi.}\).
<br><br>
The <strong>Ultimate Cluster</strong> variance estimator is simply the stratified multistage SRS
variance estimator, but ignoring variances from later stages of sampling.
$$
  v(\hat{Y}) = \hat{V}_1
$$
This is the variance estimator used in the 'survey' package when the user specifies
<code>option(survey.ultimate.cluster = TRUE)</code> or uses <code>svyrecvar(..., one.stage = TRUE)</code>.
When the first-stage sampling fractions are small, analysts often omit the finite population corrections \((1-\frac{n_h}{N_h})\)
when using the ultimate cluster estimator.
<br><br>
The <strong>SD1</strong> and <strong>SD2</strong> variance estimators are "successive difference"
estimators sometimes used for systematic sampling designs.
Ash (2014) describes each estimator as follows:
$$
  \hat{v}_{S D 1}(\hat{Y}) = \left(1-\frac{n}{N}\right) \frac{n}{2(n-1)} \sum_{k=2}^n\left(\breve{y}_k-\breve{y}_{k-1}\right)^2
$$
$$
  \hat{v}_{S D 2}(\hat{Y}) = \left(1-\frac{n}{N}\right) \frac{1}{2}\left[\sum_{k=2}^n\left(\breve{y}_k-\breve{y}_{k-1}\right)^2+\left(\breve{y}_n-\breve{y}_1\right)^2\right]
$$
where \(\breve{y}_k = y_k/\pi_k\) is the weighted value of unit \(k\)
with selection probability \(\pi_k\). The SD1 estimator is recommended by Wolter (1984).
The SD2 estimator is the basis of the successive difference replication estimator commonly
used for systematic sampling designs. See Ash (2014) for details.
<br><br>
For multistage samples, SD1 and SD2 are applied to the clusters at each stage, separately by stratum.
For later stages of sampling, the variance estimate from a stratum is multiplied by the product
of sampling fractions from earlier stages of sampling. For example, at a third stage of sampling,
the variance estimate from a third-stage stratum is multiplied by \(\frac{n_1}{N_1}\frac{n_2}{N_2}\),
which is the product of sampling fractions from the first-stage stratum and second-stage stratum.</p>
    </div>
    <div class="section level2">
    <h2 id="two-phase-designs">Two-Phase Designs<a class="anchor" aria-label="anchor" href="#two-phase-designs"></a></h2>
    

<p>For a two-phase design, <code>variance_estimator</code> should be a list of variance estimators' names,
with two elements, such as <code>list('Ultimate Cluster', 'Poisson Horvitz-Thompson')</code>.
In two-phase designs, only the following estimators may be used for the second phase:</p><ul><li><p>"Ultimate Cluster"</p></li>
<li><p>"Stratified Multistage SRS"</p></li>
<li><p>"Poisson Horvitz-Thompson"</p></li>
</ul><p>For statistical details on the handling of two-phase designs,
see the documentation for <a href="make_twophase_quad_form.html">make_twophase_quad_form</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>The generalized survey bootstrap was first proposed by Bertail and Combris (1997).
See Beaumont and Patak (2012) for a clear overview of the generalized survey bootstrap.
The generalized survey bootstrap represents one strategy for forming replication variance estimators
in the general framework proposed by Fay (1984) and Dippo, Fay, and Morganstein (1984).
<br><br>
- Ash, S. (2014). "<em>Using successive difference replication for estimating variances</em>."
<strong>Survey Methodology</strong>, Statistics Canada, 40(1), 47–59.
<br><br>
- Bellhouse, D.R. (1985). "<em>Computing Methods for Variance Estimation in Complex Surveys</em>."
<strong>Journal of Official Statistics</strong>, Vol.1, No.3.
<br><br>
- Beaumont, Jean-François, and Zdenek Patak. 2012. “On the Generalized Bootstrap for Sample Surveys with Special Attention to Poisson Sampling: Generalized Bootstrap for Sample Surveys.” International Statistical Review 80 (1): 127–48. https://doi.org/10.1111/j.1751-5823.2011.00166.x.
<br><br>
- Bertail, and Combris. 1997. “Bootstrap Généralisé d’un Sondage.” Annales d’Économie Et de Statistique, no. 46: 49. https://doi.org/10.2307/20076068.
<br><br>
- Dippo, Cathryn, Robert Fay, and David Morganstein. 1984. “Computing Variances from Complex Samples with Replicate Weights.” In, 489–94. Alexandria, VA: American Statistical Association. http://www.asasrms.org/Proceedings/papers/1984_094.pdf.
<br><br>
- Fay, Robert. 1984. “Some Properties of Estimates of Variance Based on Replication Methods.” In, 495–500. Alexandria, VA: American Statistical Association. http://www.asasrms.org/Proceedings/papers/1984_095.pdf.
<br></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Use <code><a href="estimate_boot_reps_for_target_cv.html">estimate_boot_reps_for_target_cv</a></code> to help choose the number of bootstrap replicates. <br>
For greater customization of the method, <code><a href="make_quad_form_matrix.html">make_quad_form_matrix</a></code> can be used to
represent several common variance estimators as a quadratic form's matrix,
which can then be used as an input to <code><a href="make_gen_boot_factors.html">make_gen_boot_factors</a></code>.
The function <code><a href="rescale_reps.html">rescale_reps</a></code> is used to implement
the rescaling of the bootstrap adjustment factors.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Bootstrap based on the Yates-Grundy estimator ----</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2014</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'election'</span>, package <span class="op">=</span> <span class="st">'survey'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## Create survey design object</span></span></span>
<span class="r-in"><span>   <span class="va">pps_design_yg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>     data <span class="op">=</span> <span class="va">election_pps</span>,</span></span>
<span class="r-in"><span>     id <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, fpc <span class="op">=</span> <span class="op">~</span><span class="va">p</span>,</span></span>
<span class="r-in"><span>     pps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/HR.html" class="external-link">ppsmat</a></span><span class="op">(</span><span class="va">election_jointprob</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     variance <span class="op">=</span> <span class="st">"YG"</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## Convert to generalized bootstrap replicate design</span></span></span>
<span class="r-in"><span>   <span class="va">gen_boot_design_yg</span> <span class="op">&lt;-</span> <span class="va">pps_design_yg</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>     <span class="fu">as_gen_boot_design</span><span class="op">(</span>variance_estimator <span class="op">=</span> <span class="st">"Yates-Grundy"</span>,</span></span>
<span class="r-in"><span>                        replicates <span class="op">=</span> <span class="fl">1000</span>, tau <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">Bush</span> <span class="op">+</span> <span class="va">Kerry</span>, design <span class="op">=</span> <span class="va">pps_design_yg</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">Bush</span> <span class="op">+</span> <span class="va">Kerry</span>, design <span class="op">=</span> <span class="va">gen_boot_design_yg</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2: Bootstrap based on the successive-difference estimator ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'library_stsys_sample'</span>, package <span class="op">=</span> <span class="st">'svrep'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## First, ensure data are sorted in same order as was used in sampling</span></span></span>
<span class="r-in"><span>   <span class="va">library_stsys_sample</span> <span class="op">&lt;-</span> <span class="va">library_stsys_sample</span><span class="op">[</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">library_stsys_sample</span><span class="op">$</span><span class="va">SAMPLING_SORT_ORDER</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## Create a survey design object</span></span></span>
<span class="r-in"><span>   <span class="va">design_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>     data <span class="op">=</span> <span class="va">library_stsys_sample</span>,</span></span>
<span class="r-in"><span>     strata <span class="op">=</span> <span class="op">~</span> <span class="va">SAMPLING_STRATUM</span>,</span></span>
<span class="r-in"><span>     ids <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>     fpc <span class="op">=</span> <span class="op">~</span> <span class="va">STRATUM_POP_SIZE</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## Convert to generalized bootstrap replicate design</span></span></span>
<span class="r-in"><span>   <span class="va">gen_boot_design_sd2</span> <span class="op">&lt;-</span> <span class="fu">as_gen_boot_design</span><span class="op">(</span></span></span>
<span class="r-in"><span>     design <span class="op">=</span> <span class="va">design_obj</span>,</span></span>
<span class="r-in"><span>     variance_estimator <span class="op">=</span> <span class="st">"SD2"</span>,</span></span>
<span class="r-in"><span>     replicates <span class="op">=</span> <span class="fl">2000</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## Estimate sampling variances</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">TOTSTAFF</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, design <span class="op">=</span> <span class="va">gen_boot_design_sd2</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">TOTSTAFF</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, design <span class="op">=</span> <span class="va">design_obj</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3: Two-phase sample ----</span></span></span>
<span class="r-in"><span><span class="co"># -- First stage is stratified systematic sampling,</span></span></span>
<span class="r-in"><span><span class="co"># -- second stage is response/nonresponse modeled as Poisson sampling</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">nonresponse_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">library_stsys_sample</span>,</span></span>
<span class="r-in"><span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasibinomial</a></span><span class="op">(</span><span class="st">'logit'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">RESPONSE_STATUS</span> <span class="op">==</span> <span class="st">"Survey Respondent"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>    weights <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">library_stsys_sample</span><span class="op">$</span><span class="va">SAMPLING_PROB</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">library_stsys_sample</span><span class="op">[[</span><span class="st">'RESPONSE_PROPENSITY'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">nonresponse_model</span>,</span></span>
<span class="r-in"><span>    newdata <span class="op">=</span> <span class="va">library_stsys_sample</span>,</span></span>
<span class="r-in"><span>    type <span class="op">=</span> <span class="st">"response"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">twophase_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/twophase.html" class="external-link">twophase</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">library_stsys_sample</span>,</span></span>
<span class="r-in"><span>    <span class="co"># Identify cases included in second phase sample</span></span></span>
<span class="r-in"><span>    subset <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">RESPONSE_STATUS</span> <span class="op">==</span> <span class="st">"Survey Respondent"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span> <span class="va">SAMPLING_STRATUM</span>, <span class="cn">NULL</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span>, <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="op">~</span> <span class="va">RESPONSE_PROPENSITY</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    fpc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span> <span class="va">STRATUM_POP_SIZE</span>, <span class="cn">NULL</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">twophase_boot_design</span> <span class="op">&lt;-</span> <span class="fu">as_gen_boot_design</span><span class="op">(</span></span></span>
<span class="r-in"><span>    design <span class="op">=</span> <span class="va">twophase_design</span>,</span></span>
<span class="r-in"><span>    variance_estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"SD2"</span>, <span class="st">"Poisson Horvitz-Thompson"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">LIBRARIA</span>, design <span class="op">=</span> <span class="va">twophase_boot_design</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

