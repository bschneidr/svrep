<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Rescale replicate factors — rescale_reps • svrep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rescale replicate factors — rescale_reps"><meta name="description" content="Deprecated: Please use the function
rescale_replicates instead.
Rescale replicate factors.
The main application of this rescaling is to ensure
that all replicate weights are strictly positive.
Note that this rescaling has no impact on variance estimates for totals (or other linear statistics),
but variance estimates for nonlinear statistics will be affected by the rescaling."><meta property="og:description" content="Deprecated: Please use the function
rescale_replicates instead.
Rescale replicate factors.
The main application of this rescaling is to ensure
that all replicate weights are strictly positive.
Note that this rescaling has no impact on variance estimates for totals (or other linear statistics),
but variance estimates for nonlinear statistics will be affected by the rescaling."><meta property="og:image" content="https://bschneidr.github.io/svrep/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bootstrap-replicates.html">Bootstrap Methods for Surveys</a></li>
    <li><a class="dropdown-item" href="../articles/nonresponse-adjustments.html">Nonresponse Adjustments</a></li>
    <li><a class="dropdown-item" href="../articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a></li>
    <li><a class="dropdown-item" href="../articles/two-phase-sampling.html">Replication Methods for Two-phase Sampling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Rescale replicate factors</h1>
      <small class="dont-index">Source: <a href="https://github.com/bschneidr/svrep/blob/main/R/rescale_replicates.R" class="external-link"><code>R/rescale_replicates.R</code></a></small>
      <div class="d-none name"><code>rescale_reps.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><em>Deprecated</em>: Please use the function
<code>rescale_replicates</code> instead.</p>
<p>Rescale replicate factors.
The main application of this rescaling is to ensure
that all replicate weights are strictly positive.</p>
<p>Note that this rescaling has no impact on variance estimates for totals (or other linear statistics),
but variance estimates for nonlinear statistics will be affected by the rescaling.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rescale_reps</span><span class="op">(</span><span class="va">x</span>, tau <span class="op">=</span> <span class="cn">NULL</span>, min_wgt <span class="op">=</span> <span class="fl">0.01</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Either a replicate survey design object,
or a numeric matrix of replicate weights.</p></dd>


<dt id="arg-tau">tau<a class="anchor" aria-label="anchor" href="#arg-tau"></a></dt>
<dd><p>Either a single positive number, or <code>NULL</code>.
This is the rescaling constant \(\tau\) used in the transformation
\(\frac{w + \tau - 1}{\tau}\),
where \(w\) is the original weight. <br>
If <code>tau=NULL</code> or is left unspecified,
then the argument <code>min_wgt</code> should be used instead,
in which case, \(\tau\) is automatically set to the smallest value needed to rescale
the replicate weights such that they are all at least <code>min_wgt</code>.</p></dd>


<dt id="arg-min-wgt">min_wgt<a class="anchor" aria-label="anchor" href="#arg-min-wgt"></a></dt>
<dd><p>Should only be used if <code>tau=NULL</code> or <code>tau</code> is left unspecified.
Specifies the minimum acceptable value for the rescaled weights,
which will be used to automatically determine the value \(\tau\) used
in the transformation \(\frac{w + \tau - 1}{\tau}\),
where \(w\) is the original weight.
Must be at least zero and must be less than one.</p></dd>


<dt id="arg-digits">digits<a class="anchor" aria-label="anchor" href="#arg-digits"></a></dt>
<dd><p>Only used if the argument <code>min_wgt</code> is used.
Specifies the number of decimal places
to use for choosing <code>tau</code>. Using a smaller number of <code>digits</code>
is useful simply for producing easier-to-read documentation.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If the input is a numeric matrix, returns the rescaled matrix.
If the input is a replicate survey design object, returns an updated replicate survey design object.</p>
<p>For a replicate survey design object, results depend on
whether the object has a matrix of replicate factors rather than
a matrix of replicate weights (which are the product of replicate factors and sampling weights).
If the design object has <code>combined.weights=FALSE</code>,
then the replication factors are adjusted.
If the design object has <code>combined.weights=TRUE</code>,
then the replicate weights are adjusted. It is strongly
recommended to only use the rescaling method for replication factors
rather than the weights.</p>
<p>For a replicate survey design object, the <code>scale</code> element
of the design object will be updated appropriately,
and an element <code>tau</code> will also be added.
If the input is a matrix instead of a survey design object,
the result matrix will have an attribute named <code>tau</code>
which can be retrieved using <code>attr(x, 'tau')</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Let \(\mathbf{A} = \left[ \mathbf{a}^{(1)} \cdots \mathbf{a}^{(b)} \cdots \mathbf{a}^{(B)} \right]\) denote the \((n \times B)\) matrix of replicate adjustment factors.
To eliminate negative adjustment factors, Beaumont and Patak (2012) propose forming a rescaled matrix of nonnegative replicate factors \(\mathbf{A}^S\) by rescaling each adjustment factor \(a_k^{(b)}\) as follows:
$$
   a_k^{S,(b)} = \frac{a_k^{(b)} + \tau - 1}{\tau}
 $$
where \(\tau \geq 1 - a_k^{(b)} \geq 1\) for all \(k\) in \(\left\{ 1,\ldots,n \right\}\) and all \(b\) in \(\left\{1, \ldots, B\right\}\).</p>
<p>The value of \(\tau\) can be set based on the realized adjustment factor matrix \(\mathbf{A}\) or by choosing \(\tau\) prior to generating the adjustment factor matrix \(\mathbf{A}\) so that \(\tau\) is likely to be large enough to prevent negative adjustment factors.</p>
<p>If the adjustment factors are rescaled in this manner, it is important to adjust the scale factor used in estimating the variance with the bootstrap replicates.
For example, for bootstrap replicates, the adjustment factor becomes \(\frac{\tau^2}{B}\) instead of \(\frac{1}{B}\).
$$
 \textbf{Prior to rescaling: } v_B\left(\hat{T}_y\right) = \frac{1}{B}\sum_{b=1}^B\left(\hat{T}_y^{*(b)}-\hat{T}_y\right)^2
 $$
$$
 \textbf{After rescaling: } v_B\left(\hat{T}_y\right) = \frac{\tau^2}{B}\sum_{b=1}^B\left(\hat{T}_y^{S*(b)}-\hat{T}_y\right)^2
$$</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>This method was suggested by Fay (1989) for the specific application
of creating replicate factors using his generalized replication method.
Beaumont and Patak (2012) provided an extended discussion on this rescaling
method in the context of rescaling generalized bootstrap replication factors
to avoid negative replicate weights.</p>
<p>The notation used in this documentation is taken from Beaumont and Patak (2012).</p>
<p>- Beaumont, Jean-François, and Zdenek Patak. 2012.
"On the Generalized Bootstrap for Sample Surveys with Special Attention to Poisson Sampling: Generalized Bootstrap for Sample Surveys."
International Statistical Review 80 (1): 127–48.
https://doi.org/10.1111/j.1751-5823.2011.00166.x.
<br><br>
- Fay, Robert. 1989. "Theory And Application Of Replicate Weighting For Variance Calculations."
In, 495–500. Alexandria, VA: American Statistical Association.
http://www.asasrms.org/Proceedings/papers/1989_033.pdf</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Rescaling a matrix of replicate weights to avoid negative weights</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">rep_wgts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.69742746694909</span>, <span class="op">-</span><span class="fl">0.230761178913411</span>, <span class="fl">1.53333377634192</span>,</span></span>
<span class="r-in"><span>     <span class="fl">0.0495043413294782</span>, <span class="fl">1.81820367441039</span>, <span class="fl">1.13229198793703</span>,</span></span>
<span class="r-in"><span>     <span class="fl">1.62482013925955</span>, <span class="fl">1.0866133494029</span>, <span class="fl">0.28856654131668</span>,</span></span>
<span class="r-in"><span>     <span class="fl">0.581930729719006</span>, <span class="fl">0.91827012312825</span>, <span class="fl">1.49979905894482</span>,</span></span>
<span class="r-in"><span>     <span class="fl">1.26281337410693</span>, <span class="fl">1.99327362761477</span>, <span class="op">-</span><span class="fl">0.25608700039304</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">rescaled_wgts</span> <span class="op">&lt;-</span> <span class="fu">rescale_reps</span><span class="op">(</span><span class="va">rep_wgts</span>, min_wgt <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rep_wgts</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rescaled_wgts</span><span class="op">)</span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span> <span class="co"># Example 2: Rescaling replicate weights with a specified value of 'tau'</span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span> <span class="va">rescaled_wgts</span> <span class="op">&lt;-</span> <span class="fu">rescale_reps</span><span class="op">(</span><span class="va">rep_wgts</span>, tau <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rescaled_wgts</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># Example 3: Rescaling replicate weights of a survey design object</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'mu284'</span>, package <span class="op">=</span> <span class="st">'survey'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## First create a bootstrap design object</span></span></span>
<span class="r-in"><span> <span class="va">svy_design_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>   data <span class="op">=</span> <span class="va">mu284</span>,</span></span>
<span class="r-in"><span>   ids <span class="op">=</span> <span class="op">~</span> <span class="va">id1</span> <span class="op">+</span> <span class="va">id2</span>,</span></span>
<span class="r-in"><span>   fpc <span class="op">=</span> <span class="op">~</span> <span class="va">n1</span> <span class="op">+</span> <span class="va">n2</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">boot_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="as_gen_boot_design.html">as_gen_boot_design</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>   design <span class="op">=</span> <span class="va">svy_design_object</span>,</span></span>
<span class="r-in"><span>   variance_estimator <span class="op">=</span> <span class="st">"Stratified Multistage SRS"</span>,</span></span>
<span class="r-in"><span>   replicates <span class="op">=</span> <span class="fl">5</span>, tau <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## Rescale the weights</span></span></span>
<span class="r-in"><span> <span class="va">rescaled_boot_design</span> <span class="op">&lt;-</span> <span class="va">boot_design</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>   <span class="fu">rescale_reps</span><span class="op">(</span>min_wgt <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">boot_wgts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">boot_design</span>, <span class="st">"analysis"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">rescaled_boot_wgts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">rescaled_boot_design</span>, <span class="st">'analysis'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">boot_wgts</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rescaled_boot_wgts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

