<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Variance Estimators — variance-estimators • svrep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Variance Estimators — variance-estimators"><meta name="description" content="This help page describes variance estimators
which are commonly used for survey samples. These variance estimators
can be used as the basis of the generalized replication methods, implemented
with the functions as_fays_gen_rep_design(),
as_gen_boot_design(),
make_fays_gen_rep_factors(),
or make_gen_boot_factors()"><meta property="og:description" content="This help page describes variance estimators
which are commonly used for survey samples. These variance estimators
can be used as the basis of the generalized replication methods, implemented
with the functions as_fays_gen_rep_design(),
as_gen_boot_design(),
make_fays_gen_rep_factors(),
or make_gen_boot_factors()"><meta property="og:image" content="https://bschneidr.github.io/svrep/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bootstrap-replicates.html">Bootstrap Methods for Surveys</a></li>
    <li><a class="dropdown-item" href="../articles/nonresponse-adjustments.html">Nonresponse Adjustments</a></li>
    <li><a class="dropdown-item" href="../articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a></li>
    <li><a class="dropdown-item" href="../articles/two-phase-sampling.html">Replication Methods for Two-phase Sampling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Variance Estimators</h1>
      <small class="dont-index">Source: <a href="https://github.com/bschneidr/svrep/blob/main/R/variance-estimators.R" class="external-link"><code>R/variance-estimators.R</code></a></small>
      <div class="d-none name"><code>variance-estimators.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This help page describes variance estimators
which are commonly used for survey samples. These variance estimators
can be used as the basis of the generalized replication methods, implemented
with the functions <code><a href="as_fays_gen_rep_design.html">as_fays_gen_rep_design</a>()</code>,
<code><a href="as_gen_boot_design.html">as_gen_boot_design</a>()</code>,
<code><a href="make_fays_gen_rep_factors.html">make_fays_gen_rep_factors</a>()</code>,
or <code><a href="make_gen_boot_factors.html">make_gen_boot_factors</a>()</code></p>
    </div>


    <div class="section level2">
    <h2 id="shared-notation">Shared Notation<a class="anchor" aria-label="anchor" href="#shared-notation"></a></h2>


<p>Let \(s\) denote the selected sample of size \(n\), with elements \(i=1,\dots,n\).
Element \(i\) in the sample had probability \(\pi_i\) of being included in the sample.
The <em>pair</em> of elements \(ij\) was sampled with probability \(\pi_{ij}\).</p>
<p>The population total for a variable is denoted \(Y = \sum_{i \in U}y_i\),
and the Horvitz-Thompson estimator for \(\hat{Y}\) is
denoted \(\hat{Y} = \sum_{i \in s} y_i/\pi_i\). For convenience,
we denote \(\breve{y}_i = y_i/\pi_i\).</p>
<p>The true sampling variance of \(\hat{Y}\) is denoted \(V(\hat{Y})\),
while an estimator of this sampling variance is denoted \(v(\hat{Y})\).</p>
    </div>
    <div class="section level2">
    <h2 id="horvitz-thompson">Horvitz-Thompson<a class="anchor" aria-label="anchor" href="#horvitz-thompson"></a></h2>


<p>The <strong>Horvitz-Thompson</strong> variance estimator:
$$
  v(\hat{Y}) = \sum_{i \in s}\sum_{j \in s} (1 - \frac{\pi_i \pi_j}{\pi_{ij}}) \frac{y_i}{\pi_i} \frac{y_j}{\pi_j}
$$</p>
    </div>
    <div class="section level2">
    <h2 id="yates-grundy">Yates-Grundy<a class="anchor" aria-label="anchor" href="#yates-grundy"></a></h2>


<p>The <strong>Yates-Grundy</strong> variance estimator:
$$
  v(\hat{Y}) = -\frac{1}{2}\sum_{i \in s}\sum_{j \in s} (1 - \frac{\pi_i \pi_j}{\pi_{ij}}) (\frac{y_i}{\pi_i} - \frac{y_j}{\pi_j})^2
$$</p>
    </div>
    <div class="section level2">
    <h2 id="poisson-horvitz-thompson">Poisson Horvitz-Thompson<a class="anchor" aria-label="anchor" href="#poisson-horvitz-thompson"></a></h2>


<p>The <strong>Poisson Horvitz-Thompson</strong> variance estimator
is simply the Horvitz-Thompson variance estimator, but
where \(\pi_{ij}=\pi_i \times \pi_j\), which is the case for Poisson sampling.
<br><br></p>
    </div>
    <div class="section level2">
    <h2 id="stratified-multistage-srs">Stratified Multistage SRS<a class="anchor" aria-label="anchor" href="#stratified-multistage-srs"></a></h2>


<p>The <strong>Stratified Multistage SRS</strong> variance estimator is the recursive variance estimator
proposed by Bellhouse (1985) and used in the 'survey' package's function <a href="https://rdrr.io/pkg/survey/man/svyrecvar.html" class="external-link">svyrecvar</a>.
In the case of simple random sampling without replacement (with one or more stages),
this estimator exactly matches the Horvitz-Thompson estimator.</p>
<p>The estimator can be used for any number of sampling stages. For illustration, we describe its use
for two sampling stages.
$$
  v(\hat{Y}) = \hat{V}_1 + \hat{V}_2
$$
where
$$
  \hat{V}_1 = \sum_{h=1}^{H} (1 - \frac{n_h}{N_h})\frac{n_h}{n_h - 1} \sum_{i=1}^{n_h} (y_{hi.} - \bar{y}_{hi.})^2
$$
and
$$
  \hat{V}_2 = \sum_{h=1}^{H} \frac{n_h}{N_h} \sum_{i=1}^{n_h}v_{hi}(y_{hi.})
$$
where \(n_h\) is the number of sampled clusters in stratum \(h\),
\(N_h\) is the number of population clusters in stratum \(h\),
\(y_{hi.}\) is the weighted cluster total in cluster \(i\) of stratum \(h\),
\(\bar{y}_{hi.}\) is the mean weighted cluster total of stratum \(h\),
(\(\bar{y}_{hi.} = \frac{1}{n_h}\sum_{i=1}^{n_h}y_{hi.}\)), and
\(v_{hi}(y_{hi.})\) is the estimated sampling variance of \(y_{hi.}\).
<br><br></p>
    </div>
    <div class="section level2">
    <h2 id="ultimate-cluster">Ultimate Cluster<a class="anchor" aria-label="anchor" href="#ultimate-cluster"></a></h2>


<p>The <strong>Ultimate Cluster</strong> variance estimator is simply the stratified multistage SRS
variance estimator, but ignoring variances from later stages of sampling.
$$
  v(\hat{Y}) = \hat{V}_1
$$
This is the variance estimator used in the 'survey' package when the user specifies
<code>option(survey.ultimate.cluster = TRUE)</code> or uses <code>svyrecvar(..., one.stage = TRUE)</code>.
When the first-stage sampling fractions are small, analysts often omit the finite population corrections \((1-\frac{n_h}{N_h})\)
when using the ultimate cluster estimator.</p>
    </div>
    <div class="section level2">
    <h2 id="sd-and-sd-successive-difference-estimators-">SD1 and SD2 (Successive Difference Estimators)<a class="anchor" aria-label="anchor" href="#sd-and-sd-successive-difference-estimators-"></a></h2>


<p>The <strong>SD1</strong> and <strong>SD2</strong> variance estimators are "successive difference"
estimators sometimes used for systematic sampling designs.
Ash (2014) describes each estimator as follows:
$$
  \hat{v}_{S D 1}(\hat{Y}) = \left(1-\frac{n}{N}\right) \frac{n}{2(n-1)} \sum_{k=2}^n\left(\breve{y}_k-\breve{y}_{k-1}\right)^2
$$
$$
  \hat{v}_{S D 2}(\hat{Y}) = \left(1-\frac{n}{N}\right) \frac{1}{2}\left[\sum_{k=2}^n\left(\breve{y}_k-\breve{y}_{k-1}\right)^2+\left(\breve{y}_n-\breve{y}_1\right)^2\right]
$$
where \(\breve{y}_k = y_k/\pi_k\) is the weighted value of unit \(k\)
with selection probability \(\pi_k\). The SD1 estimator is recommended by Wolter (1984).
The SD2 estimator is the basis of the successive difference replication estimator commonly
used for systematic sampling designs and is more conservative. See Ash (2014) for details.
<br><br>
For multistage samples, SD1 and SD2 are applied to the clusters at each stage, separately by stratum.
For later stages of sampling, the variance estimate from a stratum is multiplied by the product
of sampling fractions from earlier stages of sampling. For example, at a third stage of sampling,
the variance estimate from a third-stage stratum is multiplied by \(\frac{n_1}{N_1}\frac{n_2}{N_2}\),
which is the product of sampling fractions from the first-stage stratum and second-stage stratum.</p>
    </div>
    <div class="section level2">
    <h2 id="beaumont-emond">Beaumont-Emond<a class="anchor" aria-label="anchor" href="#beaumont-emond"></a></h2>


<p>The <strong>"Beaumont-Emond"</strong> variance estimator was proposed by Beaumont and Emond (2022),
intended for designs that use fixed-size, unequal-probability random sampling without replacement.
The variance estimator is simply the Horvitz-Thompson
variance estimator with the following approximation for the joint inclusion
probabilities.
$$
  \pi_{kl} \approx \pi_k \pi_l \frac{n - 1}{(n-1) + \sqrt{(1-\pi_k)(1-\pi_l)}}
$$
In the case of cluster sampling, this approximation is
applied to the clusters rather than the units within clusters,
with \(n\) denoting the number of sampled clusters. and the probabilities \(\pi\)
referring to the cluster's sampling probability. For stratified samples,
the joint probability for units \(k\) and \(l\) in different strata
is simply the product of \(\pi_k\) and \(\pi_l\).</p>
<p>For multistage samples, this approximation is applied to the clusters at each stage, separately by stratum.
For later stages of sampling, the variance estimate from a stratum is multiplied by the product
of sampling probabilities from earlier stages of sampling. For example, at a third stage of sampling,
the variance estimate from a third-stage stratum is multiplied by \(\pi_1 \times \pi_{(2 | 1)}\),
where \(\pi_1\) is the sampling probability of the first-stage unit
and \(\pi_{(2|1)}\) is the sampling probability of the second-stage unit
within the first-stage unit.</p>
    </div>
    <div class="section level2">
    <h2 id="deville-and-deville-">Deville 1 and Deville 2<a class="anchor" aria-label="anchor" href="#deville-and-deville-"></a></h2>


<p>The <strong>"Deville-1"</strong> and <strong>"Deville-2"</strong> variance estimators
are clearly described in Matei and Tillé (2005),
and are intended for designs that use
fixed-size, unequal-probability random sampling without replacement.
These variance estimators have been shown to be effective
for designs that use a fixed sample size with a high-entropy sampling method.
This includes most PPSWOR sampling methods,
but unequal-probability systematic sampling is an important exception.</p>
<p>These variance estimators take the following form:
$$
\hat{v}(\hat{Y}) = \sum_{i=1}^{n} c_i (\breve{y}_i - \frac{1}{\sum_{i=k}^{n}c_k}\sum_{k=1}^{n}c_k \breve{y}_k)^2
$$
where \(\breve{y}_i = y_i/\pi_i\) is the weighted value of the the variable of interest,
and \(c_i\) depend on the method used:</p><ul><li><p><strong>"Deville-1"</strong>:
    $$c_i=\left(1-\pi_i\right) \frac{n}{n-1}$$</p></li>
<li><p><strong>"Deville-2"</strong>:
    $$c_i = (1-\pi_i) \left[1 - \sum_{k=1}^{n} \left(\frac{1-\pi_k}{\sum_{k=1}^{n}(1-\pi_k)}\right)^2 \right]^{-1}$$</p></li>
</ul><p>In the case of simple random sampling without replacement (SRSWOR),
these estimators are both identical to the usual stratified multistage SRS estimator
(which is itself a special case of the Horvitz-Thompson estimator).</p>
<p>For multistage samples, "Deville-1" and "Deville-2" are applied to the clusters at each stage, separately by stratum.
For later stages of sampling, the variance estimate from a stratum is multiplied by the product
of sampling probabilities from earlier stages of sampling. For example, at a third stage of sampling,
the variance estimate from a third-stage stratum is multiplied by \(\pi_1 \times \pi_{(2 | 1)}\),
where \(\pi_1\) is the sampling probability of the first-stage unit
and \(\pi_{(2|1)}\) is the sampling probability of the second-stage unit
within the first-stage unit.</p>
    </div>
    <div class="section level2">
    <h2 id="bosb">BOSB<a class="anchor" aria-label="anchor" href="#bosb"></a></h2>


<p>This kernel-based variance estimator was proposed by Breidt, Opsomer, and Sanchez-Borrego (2016),
for use with samples selected using systematic sampling or where only a single
sampling unit is selected from each stratum (sometimes referred to as "fine stratification").</p>
<p>Suppose there are \(n\) sampled units, and
for each unit \(i\) there is a numeric population characteristic \(x_i\)
and there is a weighted total \(\hat{Y}_i\), where
\(\hat{Y}_i\) is only observed in the selected sample but \(x_i\)
is known prior to sampling.</p>
<p>The variance estimator has the following form:</p>
<p>$$
  \hat{V}_{ker}=\frac{1}{C_d} \sum_{i=1}^n (\hat{Y}_i-\sum_{j=1}^n d_j(i) \hat{Y}_j)^2
$$</p>
<p>The terms \(d_j(i)\) are kernel weights given by</p>
<p>$$
  d_j(i)=\frac{K(\frac{x_i-x_j}{h})}{\sum_{j=1}^n K(\frac{x_i-x_j}{h})}
$$</p>
<p>where \(K(\cdot)\) is a symmetric, bounded kernel function
and \(h\) is a bandwidth parameter. The normalizing constant \(C_d\)
is computed as:</p>
<p>$$
  C_d=\frac{1}{n} \sum_{i=1}^n(1-2 d_i(i)+\sum_{j=1}^H d_j^2(i))
$$</p>
<p>For most functions in the 'svrep' package, the kernel function
is the Epanechnikov kernel and the bandwidth is automatically selected
to yield the smallest possible nonempty kernel window, as was recommended
by Breidt, Opsomer, and Sanchez-Borrego (2016). That's the case for
the functions <code><a href="as_fays_gen_rep_design.html">as_fays_gen_rep_design()</a></code>, <code><a href="as_gen_boot_design.html">as_gen_boot_design()</a></code>,
<code><a href="make_quad_form_matrix.html">make_quad_form_matrix()</a></code>, etc. However, users can construct the quadratic
form matrix of this variance estimator using a different kernel and a different bandwidth
by directly working with the function <code><a href="make_kernel_var_matrix.html">make_kernel_var_matrix()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="deville-till-">Deville-Tillé<a class="anchor" aria-label="anchor" href="#deville-till-"></a></h2>


<p>See Section 6.8 of Tillé (2020) for more detail on this estimator,
including an explanation of its quadratic form.
See Deville and Tillé (2005) for the results of a simulation study
comparing this and other alternative estimators for balanced sampling.</p>
<p>The estimator can be written as follows:
$$
  v(\hat{Y})=\sum_{k \in S} \frac{c_k}{\pi_k^2}\left(y_k-\hat{y}_k^*\right)^2,
$$
where
$$
  \hat{y}_k^*=\mathbf{z}_k^{\top}\left(\sum_{\ell \in S} c_{\ell} \frac{\mathbf{z}_{\ell} \mathbf{z}_{\ell}^{\prime}}{\pi_{\ell}^2}\right)^{-1} \sum_{\ell \in S} c_{\ell} \frac{\mathbf{z}_{\ell} y_{\ell}}{\pi_{\ell}^2}
$$
and \(\mathbf{z}_k\) denotes the vector of auxiliary variables for observation \(k\)
included in sample \(S\), with inclusion probability \(\pi_k\). The value \(c_k\) is set to \(\frac{n}{n-q}(1-\pi_k)\),
where \(n\) is the number of observations and \(q\) is the number of auxiliary variables.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Ash, S. (2014). "<em>Using successive difference replication for estimating variances</em>."
<strong>Survey Methodology</strong>, Statistics Canada, 40(1), 47-59.</p>
<p>Beaumont, J.F.; Émond, N. (2022). "<em>A Bootstrap Variance Estimation Method for Multistage Sampling and Two-Phase Sampling When Poisson Sampling Is Used at the Second Phase</em>."
<strong>Stats</strong>, <em>5</em>: 339-357.
https://doi.org/10.3390/stats5020019</p>
<p>Bellhouse, D.R. (1985). "<em>Computing Methods for Variance Estimation in Complex Surveys</em>."
<strong>Journal of Official Statistics</strong>, Vol.1, No.3.</p>
<p>Breidt, F. J., Opsomer, J. D., &amp; Sanchez-Borrego, I. (2016).
"<em>Nonparametric Variance Estimation Under Fine Stratification: An Alternative to Collapsed Strata</em>."
<strong>Journal of the American Statistical Association</strong>, 111(514), 822-833. https://doi.org/10.1080/01621459.2015.1058264</p>
<p>Deville, J.C., and Tillé, Y. (2005). "<em>Variance approximation under balanced sampling.</em>"
<strong>Journal of Statistical Planning and Inference</strong>, 128, 569-591.</p>
<p>Tillé, Y. (2020). "<em>Sampling and estimation from finite populations</em>." (I. Hekimi, Trans.). Wiley.</p>
<p>Matei, Alina, and Yves Tillé. (2005).
"<em>Evaluation of Variance Approximations and Estimators
in Maximum Entropy Sampling with Unequal Probability and Fixed Sample Size.</em>"
<strong>Journal of Official Statistics</strong>, 21(4):543-70.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

