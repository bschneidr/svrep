<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Convert Survey Design to Random Group Jackknife Replicate Design — as_random_group_jackknife_design • svrep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert Survey Design to Random Group Jackknife Replicate Design — as_random_group_jackknife_design"><meta name="description" content="Forms a specified number of jackknife replicates
based on grouping primary sampling units (PSUs)
into random, (approximately) equal-sized groups."><meta property="og:description" content="Forms a specified number of jackknife replicates
based on grouping primary sampling units (PSUs)
into random, (approximately) equal-sized groups."><meta property="og:image" content="https://bschneidr.github.io/svrep/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bootstrap-replicates.html">Bootstrap Methods for Surveys</a></li>
    <li><a class="dropdown-item" href="../articles/nonresponse-adjustments.html">Nonresponse Adjustments</a></li>
    <li><a class="dropdown-item" href="../articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a></li>
    <li><a class="dropdown-item" href="../articles/two-phase-sampling.html">Replication Methods for Two-phase Sampling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Convert Survey Design to Random Group Jackknife Replicate Design</h1>
      <small class="dont-index">Source: <a href="https://github.com/bschneidr/svrep/blob/main/R/as_jackknife_design.R" class="external-link"><code>R/as_jackknife_design.R</code></a></small>
      <div class="d-none name"><code>as_random_group_jackknife_design.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Forms a specified number of jackknife replicates
based on grouping primary sampling units (PSUs)
into random, (approximately) equal-sized groups.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">as_random_group_jackknife_design</span><span class="op">(</span></span>
<span>  <span class="va">design</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  var_strat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var_strat_frac <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sort_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  adj_method <span class="op">=</span> <span class="st">"variance-stratum-psus"</span>,</span>
<span>  scale_method <span class="op">=</span> <span class="st">"variance-stratum-psus"</span>,</span>
<span>  group_var_name <span class="op">=</span> <span class="st">".random_group"</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"survey.replicates.mse"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>A survey design object created using the 'survey' (or 'srvyr') package,
with class <code>'survey.design'</code> or <code>'svyimputationList'</code>.</p></dd>


<dt id="arg-replicates">replicates<a class="anchor" aria-label="anchor" href="#arg-replicates"></a></dt>
<dd><p>The number of replicates to create
for each variance stratum. The total number of replicates
created is the number of variance strata times <code>replicates</code>.
Every design stratum must have at least as many primary sampling units (PSUs),
as <code>replicates</code>.</p></dd>


<dt id="arg-var-strat">var_strat<a class="anchor" aria-label="anchor" href="#arg-var-strat"></a></dt>
<dd><p>Specifies the name of a variable
in the data that defines variance strata to use
for the grouped jackknife. If <code>var_strat = NULL</code>,
then there is effectively only one variance stratum.</p></dd>


<dt id="arg-var-strat-frac">var_strat_frac<a class="anchor" aria-label="anchor" href="#arg-var-strat-frac"></a></dt>
<dd><p>Specifies the sampling fraction
to use for finite population corrections in each
value of <code>var_strat</code>. Can use either a single number
or a variable in the data corresponding to <code>var_strat</code>.</p></dd>


<dt id="arg-sort-var">sort_var<a class="anchor" aria-label="anchor" href="#arg-sort-var"></a></dt>
<dd><p>(Optional) Specifies the name of a variable
in the data which should be used to sort the data before
assigning random groups. If a variable is specified for
<code>var_strat</code>, the sorting will happen within values of
that variable.</p></dd>


<dt id="arg-adj-method">adj_method<a class="anchor" aria-label="anchor" href="#arg-adj-method"></a></dt>
<dd><p>Specifies how to calculate the
replicate weight adjustment factor.
Available options for <code>adj_method</code> include:</p><ul><li><p><code>"variance-stratum-psus"</code> (the default) <br>
    The replicate weight adjustment for a unit
    is based on the number of PSUs in its variance stratum.</p></li>
<li><p><code>"variance-units"</code> <br>
    The replicate weight adjustment for a unit
    is based on the number of variance units
    in its variance stratum.</p></li>
</ul><p>See the section "Adjustment and Scale Methods" for details.</p></dd>


<dt id="arg-scale-method">scale_method<a class="anchor" aria-label="anchor" href="#arg-scale-method"></a></dt>
<dd><p>Specifies how to calculate the
scale factor for each replicate.
Available options for <code>scale_method</code> include:</p><ul><li><p><code>"variance-stratum-psus"</code> <br>
    The scale factor for a variance unit
    is based on its number of PSUs compared
    to the number of PSUs in its variance stratum.</p></li>
<li><p><code>"variance-units"</code> <br>
    The scale factor for a variance unit is
    based on the number of variance units in
    its variance stratum.</p></li>
</ul><p>See the section "Adjustment and Scale Methods" for details.</p></dd>


<dt id="arg-group-var-name">group_var_name<a class="anchor" aria-label="anchor" href="#arg-group-var-name"></a></dt>
<dd><p>(Optional) The name of a new variable created to save
identifiers for which random group each PSU was grouped into
for the purpose of forming replicates.
Specify <code>group_var_name = NULL</code> to avoid creating the variable in the data.</p></dd>


<dt id="arg-compress">compress<a class="anchor" aria-label="anchor" href="#arg-compress"></a></dt>
<dd><p>Use a compressed representation of the replicate weights matrix.
This reduces the computer memory required to represent the replicate weights and has no
impact on estimates.</p></dd>


<dt id="arg-mse">mse<a class="anchor" aria-label="anchor" href="#arg-mse"></a></dt>
<dd><p>If <code>TRUE</code>, compute variances from sums of squares around the point estimate from the full-sample weights.
If <code>FALSE</code>, compute variances from sums of squares around the mean estimate from the replicate weights.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A replicate design object, with class <code>svyrep.design</code>, which can be used with the usual functions,
such as <code><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean()</a></code> or <code><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">svyglm()</a></code>.</p>
<p>Use <code>weights(..., type = 'analysis')</code> to extract the matrix of replicate weights. <br>
Use <code><a href="as_data_frame_with_weights.html">as_data_frame_with_weights()</a></code> to convert the design object to a data frame with columns
for the full-sample and replicate weights.</p>
    </div>
    <div class="section level2">
    <h2 id="formation-of-random-groups">Formation of Random Groups<a class="anchor" aria-label="anchor" href="#formation-of-random-groups"></a></h2>


<p>Within each value of <code>VAR_STRAT</code>,
the data are sorted by first-stage sampling strata,
and then the PSUs in each stratum are randomly arranged.
Groups are then formed by serially placing PSUs
into each group.
The first PSU in the <code>VAR_STRAT</code> is placed into the first group,
the second PSU into the second group, and so on.
Once a PSU has been assigned to the last group,
the process begins again by assigning the next PSU to the first group,
the PSU after that to the second group, and so on.</p>

<p>The random group that each observation is assigned to
can be saved as a variable in the data
by using the function argument <code>group_var_name</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="adjustment-and-scale-methods">Adjustment and Scale Methods<a class="anchor" aria-label="anchor" href="#adjustment-and-scale-methods"></a></h2>



<p>The jackknife replication variance estimator based on \(R\) replicates takes the following form:
$$
  v(\hat{\theta}) = \sum_{r=1}^{R} (1 - f_r) \times c_r \times \left(\hat{\theta}_r - \hat{\theta}\right)^2
$$
where \(r\) indexes one of the \(R\) sets of replicate weights,
\(c_r\) is a corresponding scale factor for the \(r\)-th replicate,
and \(1 - f_r\) is an optional finite population correction factor
that can potentially differ across variance strata.</p>
<p>To form the replicate weights, the PSUs are divided into \(\tilde{H}\) variance strata,
and the \(\tilde{h}\)-th variance stratum contains \(G_{\tilde{h}}\)
random groups. The number of replicates \(R\) equals the total number
of random groups across all variance strata:
\(R = \sum_{\tilde{h}}^{\tilde{H}} G_{\tilde{h}}\). In other words,
each replicate corresponds to one of the random groups from one of the variance strata.</p>
<p>The weights for replicate \(r\) corresponding to random group \(g\) within
variance stratum \(\tilde{h}\) is defined as follows.</p>
<p>If case \(i\)
is not in variance stratum \(\tilde{h}\), then \(w_{i}^{(r)} = w_i\).</p>
<p>If case \(i\) is in variance stratum \(\tilde{h}\) and not in random group \(g\),
then \(w_{i}^{(r)} = a_{\tilde{h}g} w_i\).</p>
<p>Otherwise, if case \(i\) is in random group \(g\)
of variance stratum \(\tilde{h}\), then \(w_{i}^{(r)} = 0\).</p>
<p>The R function argument <code>adj_method</code> determines how
the adjustment factor \(a_{\tilde{h} g}\) is calculated.
When <code>adj_method = "variance-units"</code>, then
\(a_{\tilde{h} g}\) is calculated based on \(G_{\tilde{h}}\),
which is the number of random groups in variance stratum \(\tilde{h}\).
When <code>adj_method = "variance-stratum-psus"</code>, then
\(a_{\tilde{h} g}\) is calculated based on \(n_{\tilde{h}g}\),
which is the number of PSUs in random group \(g\) in variance stratum \(\tilde{h}\),
as well as \(n_{\tilde{h}}\), the total number of PSUs in variance stratum \(\tilde{h}\).</p>
<p>If <code>adj_method = "variance-units"</code>, then: $$a_{\tilde{h}g} = \frac{G_{\tilde{h}}}{G_{\tilde{h}} - 1}$$</p>
<p>If <code>adj_method = "variance-stratum-psus"</code>, then: $$a_{\tilde{h}g} = \frac{n_{\tilde{h}}}{n_{\tilde{h}} - n_{\tilde{h}g}}$$</p>
<p>The scale factor \(c_r\) for replicate \(r\)
corresponding to random group \(g\) within variance stratum \(\tilde{h}\) is
calculated according to the function argument <code>scale_method</code>.</p>
<p>If <code>scale_method = "variance-units"</code>, then: $$c_r = \frac{G_{\tilde{h}} - 1}{G_{\tilde{h}}}$$</p>
<p>If <code>scale_method = "variance-stratum-psus"</code>, then: $$c_r = \frac{n_{\tilde{h}} - n_{\tilde{h}g}}{n_{\tilde{h}}}$$</p>
<p>The sampling fraction \(f_r\) used for finite population correction \(1 - f_r\)
is by default assumed to equal 0. However, the user can supply a sampling fraction
for each variance stratum using the argument <code>var_strat_frac</code>.</p>
<p>When variance units in a variance stratum
have differing numbers of PSUs,
the combination <code>adj_method = "variance-stratum-psus"</code>
and <code>scale_method = "variance-units"</code> is
recommended by Valliant, Brick, and Dever (2008),
corresponding to their method <code>"GJ2"</code>.</p>
<p>The random-groups jackknife method often referred to as "DAGJK"
corresponds to the options <code>var_strat = NULL</code>,
<code>adj_method = "variance-units"</code>, and <code>scale_method = "variance-units"</code>.
The DAGJK method will yield upwardly-biased variance estimates for totals
if the total number of PSUs is not a multiple of the total number of replicates (Valliant, Brick, and Dever 2008).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>See Section 15.5 of Valliant, Dever, and Kreuter (2018)
for an introduction to the grouped jackknife and
guidelines for creating the random groups.</p>
<p>- Valliant, R., Dever, J., Kreuter, F. (2018).
"Practical Tools for Designing and Weighting Survey Samples, 2nd edition." New York: Springer.</p>
<p>See Valliant, Brick, and Dever (2008)
for statistical details related to the
<code>adj_method</code> and <code>scale_method</code> arguments.</p>
<p>- Valliant, Richard, Michael Brick, and Jill Dever. 2008.
"Weight Adjustments for the Grouped Jackknife Variance Estimator."
<em>Journal of Official Statistics</em>. 24: 469-88.</p>
<p>See Chapter 4 of Wolter (2007) for additional details of the jackknife,
including the method based on random groups.</p>
<p>- Wolter, Kirk. 2007. "Introduction to Variance Estimation." New York, NY: Springer New York. https://doi.org/10.1007/978-0-387-35099-8.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load example data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'api'</span>, package <span class="op">=</span> <span class="st">'survey'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">api_strat_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>   data <span class="op">=</span> <span class="va">apistrat</span>,</span></span>
<span class="r-in"><span>   id <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>   strata <span class="op">=</span> <span class="op">~</span><span class="va">stype</span>,</span></span>
<span class="r-in"><span>   weights <span class="op">=</span> <span class="op">~</span><span class="va">pw</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a random-groups jackknife design</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">jk_design</span> <span class="op">&lt;-</span> <span class="fu">as_random_group_jackknife_design</span><span class="op">(</span></span></span>
<span class="r-in"><span>   <span class="va">api_strat_design</span>,</span></span>
<span class="r-in"><span>   replicates <span class="op">=</span> <span class="fl">15</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">jk_design</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call: as_random_group_jackknife_design(api_strat_design, replicates = 15)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> with 15 replicates.</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

