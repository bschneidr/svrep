<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Creates bootstrap replicate weights for a multistage stratified sample design
using the method of Beaumont and Émond (2022), which is a generalization of the Rao-Wu-Yue bootstrap.  
The design may have different sampling methods used at different stages.
Each stage of sampling may potentially use unequal probabilities (with or without replacement)
and may potentially use Poisson sampling."><title>Create bootstrap replicate weights for a general survey design,
using the Rao-Wu-Yue-Beaumont bootstrap method — make_rwyb_bootstrap_weights • svrep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create bootstrap replicate weights for a general survey design,
using the Rao-Wu-Yue-Beaumont bootstrap method — make_rwyb_bootstrap_weights"><meta property="og:description" content="Creates bootstrap replicate weights for a multistage stratified sample design
using the method of Beaumont and Émond (2022), which is a generalization of the Rao-Wu-Yue bootstrap.  
The design may have different sampling methods used at different stages.
Each stage of sampling may potentially use unequal probabilities (with or without replacement)
and may potentially use Poisson sampling."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/bootstrap-replicates.html">Bootstrap Methods for Surveys</a>
    <a class="dropdown-item" href="../articles/nonresponse-adjustments.html">Nonresponse Adjustments</a>
    <a class="dropdown-item" href="../articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create bootstrap replicate weights for a general survey design,
using the Rao-Wu-Yue-Beaumont bootstrap method</h1>
      <small class="dont-index">Source: <a href="https://github.com/bschneidr/svrep/blob/HEAD/R/make_bootstrap_weights.R" class="external-link"><code>R/make_bootstrap_weights.R</code></a></small>
      <div class="d-none name"><code>make_rwyb_bootstrap_weights.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates bootstrap replicate weights for a multistage stratified sample design
using the method of Beaumont and Émond (2022), which is a generalization of the Rao-Wu-Yue bootstrap. <br><br>
The design may have different sampling methods used at different stages.
Each stage of sampling may potentially use unequal probabilities (with or without replacement)
and may potentially use Poisson sampling.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make_rwyb_bootstrap_weights</span><span class="op">(</span></span>
<span>  num_replicates <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  <span class="va">samp_unit_ids</span>,</span>
<span>  <span class="va">strata_ids</span>,</span>
<span>  <span class="va">samp_unit_sel_probs</span>,</span>
<span>  samp_method_by_stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PPSWOR"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">samp_unit_ids</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  allow_final_stage_singletons <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"weights"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>num_replicates</dt>
<dd><p>Positive integer giving the number of bootstrap replicates to create</p></dd>


<dt>samp_unit_ids</dt>
<dd><p>Matrix or data frame of sampling unit IDs for each stage of sampling</p></dd>


<dt>strata_ids</dt>
<dd><p>Matrix or data frame of strata IDs for each sampling unit at each stage of sampling</p></dd>


<dt>samp_unit_sel_probs</dt>
<dd><p>Matrix or data frame of selection probabilities for each sampling unit
at each stage of sampling.</p></dd>


<dt>samp_method_by_stage</dt>
<dd><p>A vector with length equal to the number of stages of sampling,
corresponding to the number of columns in <code>samp_unit_ids</code>.
This describes the method of sampling used at each stage.
Each element should be one of the following: <br></p><ul><li><p>"SRSWOR" - Simple random sampling, without replacement</p></li>
<li><p>"SRSWR" - Simple random sampling, with replacement</p></li>
<li><p>"PPSWOR" - Unequal probabilities of selection, without replacement</p></li>
<li><p>"PPSWR" - Unequal probabilities of selection, with replacement</p></li>
<li><p>"Poisson" -  Poisson sampling: each sampling unit is selected into the sample at most once, with potentially different probabilities of inclusion for each sampling unit.</p></li>
</ul></dd>


<dt>allow_final_stage_singletons</dt>
<dd><p>Logical value indicating whether to allow
non-certainty singleton strata at the final sampling stage (rather than throw an error message). <br>
If <code>TRUE</code>, the sampling unit in a non-certainty singleton stratum will have its final-stage adjustment factor
calculated as if it was selected with certainty at the final stage (i.e., its adjustment factor will be 1),
and then its final bootstrap weight will be calculated by combining this adjustment factor
with its final-stage selection probability.</p></dd>


<dt>output</dt>
<dd><p>Either <code>"weights"</code> (the default) or <code>"factors"</code>.
Specifying <code>output = "factors"</code> returns a matrix of replicate adjustment factors which can later be multiplied by
the full-sample weights to produce a matrix of replicate weights. Specifying <code>output = "weights"</code>
returns the matrix of replicate weights, where the full-sample weights are inferred using <code>samp_unit_sel_probs</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A matrix of with the same number of rows as <code>samp_unit_ids</code></p>


<p>and the number of columns equal to the value of the argument <code>num_replicates</code>.
Specifying <code>output = "factors"</code> returns a matrix of replicate adjustment factors which can later be multiplied by
the full-sample weights to produce a matrix of replicate weights.
Specifying <code>output = "weights"</code> returns the matrix of replicate weights,
where the full-sample weights are inferred using <code>samp_unit_sel_probs</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Beaumont and Émond (2022) describe a general algorithm for forming bootstrap replicate weights
for multistage stratified samples, based on the method of Rao-Wu-Yue, with extensions
to sampling without replacement and use of unequal probabilities of selection
(i.e., sampling with probability proportional to size) as well as Poisson sampling. These methods
are guaranteed to produce nonnegative replicate weights and provide design-unbiased and design-consistent variance estimates for totals,
for designs where sampling uses one or more of the following methods:</p><ul><li><p>"SRSWOR" - Simple random sampling, without replacement</p></li>
<li><p>"SRSWR" - Simple random sampling, with replacement</p></li>
<li><p>"PPSWR" - Unequal probabilities of selection, with replacement</p></li>
<li><p>"Poisson" -  Poisson sampling: each sampling unit is selected into the sample at most once, with potentially different probabilities of inclusion for each sampling unit.</p></li>
</ul><p>For designs where at least one stage's strata have sampling without replacement with unequal probabilities of selection ("PPSWOR"),
the bootstrap method of Beaumont and Émond (2022) is guaranteed to produce nonnegative weights, but is not design-unbiased,
since the method only approximates the joint selection probabilities which would be needed for unbiased estimation.
<br><br>
Unless any stages use simple random sampling without replacement, the resulting bootstrap replicate weights
are guaranteed to all be strictly positive, which may be useful for calibration or analyses of domains with small sample sizes.
If any stages use simple random sampling without replacement, it is possible for some replicate weights to be zero.
<br><br>
If there is survey nonresponse, it may be useful to represent the response/nonresponse as an additional
stage of sampling, where sampling is conducted with Poisson sampling
where each unit's "selection probability" at that stage is its response propensity (which typically has to be estimated).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Beaumont, J.-F.; Émond, N. (2022).
"A Bootstrap Variance Estimation Method for Multistage Sampling and Two-Phase Sampling When Poisson Sampling Is Used at the Second Phase."
<strong>Stats</strong>, <em>5</em>: 339–357.
https://doi.org/10.3390/stats5020019</p>
<p>Rao, J.N.K.; Wu, C.F.J.; Yue, K. (1992).
"Some recent work on resampling methods for complex surveys."
<strong>Surv. Methodol.</strong>, <em>18</em>: 209–217.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>If the survey design can be accurately represented using <code><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></code>,
 then it is easier to simply use <code><a href="as_bootstrap_design.html">as_bootstrap_design</a></code> with argument <code>type = "Rao-Wu-Yue-Beaumont"</code>.</p>
<p>Use <code><a href="estimate_boot_reps_for_target_cv.html">estimate_boot_reps_for_target_cv</a></code> to help choose the number of bootstrap replicates.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># Example 1: A multistage sample with two stages of SRSWOR</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>     <span class="co">## Load an example dataset from a multistage sample, with two stages of SRSWOR</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mu284"</span>, package <span class="op">=</span> <span class="st">'survey'</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="va">multistage_srswor_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mu284</span>,</span></span>
<span class="r-in"><span>                                           ids <span class="op">=</span> <span class="op">~</span> <span class="va">id1</span> <span class="op">+</span> <span class="va">id2</span>,</span></span>
<span class="r-in"><span>                                           fpc <span class="op">=</span> <span class="op">~</span> <span class="va">n1</span> <span class="op">+</span> <span class="va">n2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>     <span class="co">## Create bootstrap replicate weights</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="va">bootstrap_replicate_weights</span> <span class="op">&lt;-</span> <span class="fu">make_rwyb_bootstrap_weights</span><span class="op">(</span></span></span>
<span class="r-in"><span>       num_replicates <span class="op">=</span> <span class="fl">5000</span>,</span></span>
<span class="r-in"><span>       samp_unit_ids <span class="op">=</span> <span class="va">multistage_srswor_design</span><span class="op">$</span><span class="va">cluster</span>,</span></span>
<span class="r-in"><span>       strata_ids <span class="op">=</span> <span class="va">multistage_srswor_design</span><span class="op">$</span><span class="va">strata</span>,</span></span>
<span class="r-in"><span>       samp_unit_sel_probs <span class="op">=</span> <span class="va">multistage_srswor_design</span><span class="op">$</span><span class="va">fpc</span><span class="op">$</span><span class="va">sampsize</span> <span class="op">/</span></span></span>
<span class="r-in"><span>                             <span class="va">multistage_srswor_design</span><span class="op">$</span><span class="va">fpc</span><span class="op">$</span><span class="va">popsize</span>,</span></span>
<span class="r-in"><span>       samp_method_by_stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SRSWOR"</span>, <span class="st">"SRSWOR"</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>     <span class="co">## Create a replicate design object with the survey package</span></span></span>
<span class="r-in"><span>     <span class="va">bootstrap_rep_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svrepdesign.html" class="external-link">svrepdesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>       data <span class="op">=</span> <span class="va">multistage_srswor_design</span><span class="op">$</span><span class="va">variables</span>,</span></span>
<span class="r-in"><span>       repweights <span class="op">=</span> <span class="va">bootstrap_replicate_weights</span>,</span></span>
<span class="r-in"><span>       weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">multistage_srswor_design</span>, type <span class="op">=</span> <span class="st">"sampling"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       type <span class="op">=</span> <span class="st">"bootstrap"</span></span></span>
<span class="r-in"><span>     <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>     <span class="co">## Compare std. error estimates from bootstrap versus linearization</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>       <span class="st">'Statistic'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'total'</span>, <span class="st">'mean'</span>, <span class="st">'median'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       <span class="st">'SE (bootstrap)'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">y1</span>, design <span class="op">=</span> <span class="va">bootstrap_rep_design</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">y1</span>, design <span class="op">=</span> <span class="va">bootstrap_rep_design</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyquantile.html" class="external-link">svyquantile</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">y1</span>, quantile <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                                           design <span class="op">=</span> <span class="va">bootstrap_rep_design</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       <span class="st">'SE (linearization)'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">y1</span>, design <span class="op">=</span> <span class="va">multistage_srswor_design</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">y1</span>, design <span class="op">=</span> <span class="va">multistage_srswor_design</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyquantile.html" class="external-link">svyquantile</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">y1</span>, quantile <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                                               design <span class="op">=</span> <span class="va">multistage_srswor_design</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       check.names <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>     <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># Example 2: A single-stage sample selected with unequal probabilities, without replacement</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>     <span class="co">## Load an example dataset of U.S. counties states with 2004 Presidential vote counts</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"election"</span>, package <span class="op">=</span> <span class="st">'survey'</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="va">pps_wor_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">election_pps</span>,</span></span>
<span class="r-in"><span>                                 pps <span class="op">=</span> <span class="st">"overton"</span>,</span></span>
<span class="r-in"><span>                                 fpc <span class="op">=</span> <span class="op">~</span> <span class="va">p</span>, <span class="co"># Inclusion probabilities</span></span></span>
<span class="r-in"><span>                                 ids <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>     <span class="co">## Create bootstrap replicate weights</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="va">bootstrap_replicate_weights</span> <span class="op">&lt;-</span> <span class="fu">make_rwyb_bootstrap_weights</span><span class="op">(</span></span></span>
<span class="r-in"><span>       num_replicates <span class="op">=</span> <span class="fl">5000</span>,</span></span>
<span class="r-in"><span>       samp_unit_ids <span class="op">=</span> <span class="va">pps_wor_design</span><span class="op">$</span><span class="va">cluster</span>,</span></span>
<span class="r-in"><span>       strata_ids <span class="op">=</span> <span class="va">pps_wor_design</span><span class="op">$</span><span class="va">strata</span>,</span></span>
<span class="r-in"><span>       samp_unit_sel_probs <span class="op">=</span> <span class="va">pps_wor_design</span><span class="op">$</span><span class="va">prob</span>,</span></span>
<span class="r-in"><span>       samp_method_by_stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PPSWOR"</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>     <span class="co">## Create a replicate design object with the survey package</span></span></span>
<span class="r-in"><span>     <span class="va">bootstrap_rep_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svrepdesign.html" class="external-link">svrepdesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>       data <span class="op">=</span> <span class="va">pps_wor_design</span><span class="op">$</span><span class="va">variables</span>,</span></span>
<span class="r-in"><span>       repweights <span class="op">=</span> <span class="va">bootstrap_replicate_weights</span>,</span></span>
<span class="r-in"><span>       weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">pps_wor_design</span>, type <span class="op">=</span> <span class="st">"sampling"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       type <span class="op">=</span> <span class="st">"bootstrap"</span></span></span>
<span class="r-in"><span>     <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>     <span class="co">## Compare std. error estimates from bootstrap versus linearization</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>       <span class="st">'Statistic'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'total'</span>, <span class="st">'mean'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       <span class="st">'SE (bootstrap)'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">Bush</span>, design <span class="op">=</span> <span class="va">bootstrap_rep_design</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Bush</span><span class="op">/</span><span class="va">votes</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                       design <span class="op">=</span> <span class="va">bootstrap_rep_design</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       <span class="st">'SE (Overton\'s PPS approximation)'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">Bush</span>,</span></span>
<span class="r-in"><span>                                                           design <span class="op">=</span> <span class="va">pps_wor_design</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                               <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Bush</span><span class="op">/</span><span class="va">votes</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                                          design <span class="op">=</span> <span class="va">pps_wor_design</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       check.names <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>     <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

