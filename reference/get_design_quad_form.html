<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Determine the quadratic form matrix of a variance estimator for a survey design object — get_design_quad_form • svrep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Determine the quadratic form matrix of a variance estimator for a survey design object — get_design_quad_form"><meta name="description" content="Determines the quadratic form matrix of a specified variance estimator,
by parsing the information stored in a survey design object created using
the 'survey' package."><meta property="og:description" content="Determines the quadratic form matrix of a specified variance estimator,
by parsing the information stored in a survey design object created using
the 'survey' package."><meta property="og:image" content="https://bschneidr.github.io/svrep/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bootstrap-replicates.html">Bootstrap Methods for Surveys</a></li>
    <li><a class="dropdown-item" href="../articles/nonresponse-adjustments.html">Nonresponse Adjustments</a></li>
    <li><a class="dropdown-item" href="../articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a></li>
    <li><a class="dropdown-item" href="../articles/two-phase-sampling.html">Replication Methods for Two-phase Sampling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Determine the quadratic form matrix of a variance estimator for a survey design object</h1>
      <small class="dont-index">Source: <a href="https://github.com/bschneidr/svrep/blob/v0.8.0/R/quadratic_forms_of_survey_design_objects.R" class="external-link"><code>R/quadratic_forms_of_survey_design_objects.R</code></a></small>
      <div class="d-none name"><code>get_design_quad_form.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Determines the quadratic form matrix of a specified variance estimator,
by parsing the information stored in a survey design object created using
the 'survey' package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_design_quad_form</span><span class="op">(</span></span>
<span>  <span class="va">design</span>,</span>
<span>  <span class="va">variance_estimator</span>,</span>
<span>  ensure_psd <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  aux_var_names <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>A survey design object created using the 'survey' (or 'srvyr') package,
with class <code>'survey.design'</code> or <code>'svyimputationList'</code>. Also accepts two-phase design objects
with class <code>'twophase2'</code>; see the section below titled "Two-Phase Designs" for
more information about handling of two-phase designs.</p></dd>


<dt id="arg-variance-estimator">variance_estimator<a class="anchor" aria-label="anchor" href="#arg-variance-estimator"></a></dt>
<dd><p>The name of the variance estimator
whose quadratic form matrix should be created. <br>
See the section "Variance Estimators" below.
Options include:</p><ul><li><p><strong>"Yates-Grundy"</strong>: <br> The Yates-Grundy variance estimator based on
    first-order and second-order inclusion probabilities.</p></li>
<li><p><strong>"Horvitz-Thompson"</strong>: <br> The Horvitz-Thompson variance estimator based on
    first-order and second-order inclusion probabilities.</p></li>
<li><p><strong>"Poisson Horvitz-Thompson"</strong>: <br> The Horvitz-Thompson variance estimator
    based on assuming Poisson sampling, with first-order inclusion probabilities
    inferred from the sampling probabilities of the survey design object.</p></li>
<li><p><strong>"Stratified Multistage SRS"</strong>: <br> The usual stratified multistage variance estimator
    based on estimating the variance of cluster totals within strata at each stage.</p></li>
<li><p><strong>"Ultimate Cluster"</strong>: <br> The usual variance estimator based on estimating
    the variance of first-stage cluster totals within first-stage strata.</p></li>
<li><p><strong>"Deville-1"</strong>: <br> A variance estimator for unequal-probability
    sampling without replacement, described in Matei and Tillé (2005)
    as "Deville 1".</p></li>
<li><p><strong>"Deville-2"</strong>: <br> A variance estimator for unequal-probability
    sampling without replacement, described in Matei and Tillé (2005) as "Deville 2".</p></li>
<li><p><strong>"Deville-Tille": </strong> <br> A variance estimator useful
    for balanced sampling designs, proposed by Deville and Tillé (2005).</p></li>
<li><p><strong>"SD1"</strong>: <br> The non-circular successive-differences variance estimator described by Ash (2014),
    sometimes used for variance estimation for systematic sampling.</p></li>
<li><p><strong>"SD2"</strong>:  <br> The circular successive-differences variance estimator described by Ash (2014).
    This estimator is the basis of the "successive-differences replication" estimator commonly used
    for variance estimation for systematic sampling.</p></li>
<li><p><strong>"Beaumont-Emond"</strong>: <br> The variance estimator of Beaumont and Emond (2022)
    for multistage unequal-probability sampling without replacement.</p></li>
<li><p><strong>"BOSB"</strong>: <br> The kernel-based variance estimator proposed by
    Breidt, Opsomer, and Sanchez-Borrego (2016) for use with systematic samples
    or other finely stratified designs. Uses the Epanechnikov kernel
    with the bandwidth automatically chosen to result in the smallest possible
    nonempty kernel window.</p></li>
</ul></dd>


<dt id="arg-ensure-psd">ensure_psd<a class="anchor" aria-label="anchor" href="#arg-ensure-psd"></a></dt>
<dd><p>If <code>TRUE</code> (the default), ensures
that the result is a positive semidefinite matrix. This
is necessary if the quadratic form is used as an input for
replication methods such as the generalized bootstrap.
For mathematical details, please see the documentation for the function <code><a href="get_nearest_psd_matrix.html">get_nearest_psd_matrix()</a></code>.
The approximation method is discussed by Beaumont and Patak (2012)
in the context of forming replicate weights for two-phase samples.
The authors argue that this approximation should
lead to only a small overestimation of variance.</p></dd>


<dt id="arg-aux-var-names">aux_var_names<a class="anchor" aria-label="anchor" href="#arg-aux-var-names"></a></dt>
<dd><p>Only required if <code>variance_estimator = "Deville-Tille"</code>
or if <code>variance_estimator = "BOSB"</code>.
For the Deville-Tillé estimator, this should be a character vector of
variable names for auxiliary variables to be used in the variance estimator.
For the BOSB estimator, this should be a string giving a single variable name
to use as an auxiliary variable in the kernel-based variance estimator
of Breidt, Opsomer, and Sanchez-Borrego (2016).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A matrix representing the quadratic form of a specified variance estimator,
based on extracting information about clustering, stratification,
and selection probabilities from the survey design object.</p>
    </div>
    <div class="section level2">
    <h2 id="variance-estimators">Variance Estimators<a class="anchor" aria-label="anchor" href="#variance-estimators"></a></h2>


<p>See <a href="variance-estimators.html">variance-estimators</a> for a
description of each variance estimator.</p>
    </div>
    <div class="section level2">
    <h2 id="two-phase-designs">Two-Phase Designs<a class="anchor" aria-label="anchor" href="#two-phase-designs"></a></h2>


<p>For a two-phase design, <code>variance_estimator</code> should be a list of variance estimators' names,
with two elements, such as <code>list('Ultimate Cluster', 'Poisson Horvitz-Thompson')</code>.
In two-phase designs, only the following estimators may be used for the second phase:</p><ul><li><p>"Ultimate Cluster"</p></li>
<li><p>"Stratified Multistage SRS"</p></li>
<li><p>"Poisson Horvitz-Thompson"</p></li>
</ul><p>For statistical details on the handling of two-phase designs,
see the documentation for <a href="make_twophase_quad_form.html">make_twophase_quad_form</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>- Ash, S. (2014). "<em>Using successive difference replication for estimating variances</em>."
<strong>Survey Methodology</strong>, Statistics Canada, 40(1), 47-59.
<br><br>
- Beaumont, Jean-François, and Zdenek Patak. (2012). "<em>On the Generalized Bootstrap for Sample Surveys with Special Attention to Poisson Sampling: Generalized Bootstrap for Sample Surveys.</em>"
<strong>International Statistical Review</strong> 80 (1): 127-48.
<br><br>
- Bellhouse, D.R. (1985). "<em>Computing Methods for Variance Estimation in Complex Surveys</em>."
<strong>Journal of Official Statistics</strong>, Vol.1, No.3.
<br><br>
- Breidt, F. J., Opsomer, J. D., &amp; Sanchez-Borrego, I. (2016).
"<em>Nonparametric Variance Estimation Under Fine Stratification: An Alternative to Collapsed Strata</em>."
<strong>Journal of the American Statistical Association</strong>, 111(514), 822-833. https://doi.org/10.1080/01621459.2015.1058264
<br><br>
- Deville, J.C., and Tillé, Y. (2005). "<em>Variance approximation under balanced sampling.</em>"
<strong>Journal of Statistical Planning and Inference</strong>, 128, 569-591.
<br><br>
- Särndal, C.E., Swensson, B., &amp; Wretman, J. (1992). "<em>Model Assisted Survey Sampling</em>." Springer New York.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Quadratic form for successive-difference variance estimator ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'library_stsys_sample'</span>, package <span class="op">=</span> <span class="st">'svrep'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## First, ensure data are sorted in same order as was used in sampling</span></span></span>
<span class="r-in"><span>   <span class="va">library_stsys_sample</span> <span class="op">&lt;-</span> <span class="va">library_stsys_sample</span><span class="op">[</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">library_stsys_sample</span><span class="op">$</span><span class="va">SAMPLING_SORT_ORDER</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## Create a survey design object</span></span></span>
<span class="r-in"><span>   <span class="va">design_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>     data <span class="op">=</span> <span class="va">library_stsys_sample</span>,</span></span>
<span class="r-in"><span>     strata <span class="op">=</span> <span class="op">~</span> <span class="va">SAMPLING_STRATUM</span>,</span></span>
<span class="r-in"><span>     ids <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>     fpc <span class="op">=</span> <span class="op">~</span> <span class="va">STRATUM_POP_SIZE</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## Obtain quadratic form</span></span></span>
<span class="r-in"><span>   <span class="va">quad_form_matrix</span> <span class="op">&lt;-</span> <span class="fu">get_design_quad_form</span><span class="op">(</span></span></span>
<span class="r-in"><span>     design <span class="op">=</span> <span class="va">design_obj</span>,</span></span>
<span class="r-in"><span>     variance_estimator <span class="op">=</span> <span class="st">"SD2"</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co">## Estimate variance of estimated population total</span></span></span>
<span class="r-in"><span>   <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">design_obj</span><span class="op">$</span><span class="va">variables</span><span class="op">$</span><span class="va">LIBRARIA</span></span></span>
<span class="r-in"><span>   <span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">design_obj</span>, type <span class="op">=</span> <span class="st">'sampling'</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">y_wtd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="va">wts</span></span></span>
<span class="r-in"><span>   <span class="va">y_wtd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y_wtd</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="va">pop_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y_wtd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="va">var_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">y_wtd</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">quad_form_matrix</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">y_wtd</span></span></span>
<span class="r-in"><span>   <span class="va">std_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var_est</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pop_total</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">std_error</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co"># Compare to estimate from assuming SRS</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">LIBRARIA</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>            design <span class="op">=</span> <span class="va">design_obj</span><span class="op">)</span></span></span>
<span class="r-in"><span>            </span></span>
<span class="r-in"><span><span class="co"># Example 2: Kernel-based variance estimator ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="va">Q_BOSB</span> <span class="op">&lt;-</span> <span class="fu">get_design_quad_form</span><span class="op">(</span></span></span>
<span class="r-in"><span>     design             <span class="op">=</span> <span class="va">design_obj</span>,</span></span>
<span class="r-in"><span>     variance_estimator <span class="op">=</span> <span class="st">"BOSB"</span>,</span></span>
<span class="r-in"><span>     aux_var_names      <span class="op">=</span> <span class="st">"SAMPLING_SORT_ORDER"</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="va">var_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">y_wtd</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Q_BOSB</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">y_wtd</span></span></span>
<span class="r-in"><span>   <span class="va">std_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var_est</span><span class="op">)</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pop_total</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">std_error</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3: Two-phase design (second phase is nonresponse) ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Estimate response propensities, separately by stratum</span></span></span>
<span class="r-in"><span>  <span class="va">library_stsys_sample</span><span class="op">[[</span><span class="st">'RESPONSE_PROB'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyglm.html" class="external-link">svyglm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    design <span class="op">=</span> <span class="va">design_obj</span>,</span></span>
<span class="r-in"><span>    formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">RESPONSE_STATUS</span> <span class="op">==</span> <span class="st">"Survey Respondent"</span><span class="op">)</span> <span class="op">~</span> <span class="va">SAMPLING_STRATUM</span>,</span></span>
<span class="r-in"><span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasibinomial</a></span><span class="op">(</span><span class="st">'logistic'</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Create a survey design object,</span></span></span>
<span class="r-in"><span>  <span class="co">## where nonresponse is treated as a second phase of sampling</span></span></span>
<span class="r-in"><span>  <span class="va">twophase_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/twophase.html" class="external-link">twophase</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">library_stsys_sample</span>,</span></span>
<span class="r-in"><span>    strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span> <span class="va">SAMPLING_STRATUM</span>, <span class="cn">NULL</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span>, <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    fpc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span> <span class="va">STRATUM_POP_SIZE</span>, <span class="cn">NULL</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="op">~</span> <span class="va">RESPONSE_PROB</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    subset <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">RESPONSE_STATUS</span> <span class="op">==</span> <span class="st">"Survey Respondent"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Obtain quadratic form for the two-phase variance estimator,</span></span></span>
<span class="r-in"><span>  <span class="co">## where first phase variance contribution estimated</span></span></span>
<span class="r-in"><span>  <span class="co">## using the successive differences estimator</span></span></span>
<span class="r-in"><span>  <span class="co">## and second phase variance contribution estimated</span></span></span>
<span class="r-in"><span>  <span class="co">## using the Horvitz-Thompson estimator</span></span></span>
<span class="r-in"><span>  <span class="co">## (with joint probabilities based on assumption of Poisson sampling)</span></span></span>
<span class="r-in"><span>  <span class="fu">get_design_quad_form</span><span class="op">(</span></span></span>
<span class="r-in"><span>    design <span class="op">=</span> <span class="va">twophase_design</span>,</span></span>
<span class="r-in"><span>    variance_estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"SD2"</span>,</span></span>
<span class="r-in"><span>      <span class="st">"Poisson Horvitz-Thompson"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

