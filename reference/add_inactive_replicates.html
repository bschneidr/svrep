<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add inactive replicates to a survey design object — add_inactive_replicates • svrep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add inactive replicates to a survey design object — add_inactive_replicates"><meta name="description" content="Adds inactive replicates to a survey design object. An inactive
replicate is a replicate that does not contribute to variance estimates but
adds to the matrix of replicate weights so that the matrix has the desired
number of columns. The new replicates' values are simply equal to the full-sample weights."><meta property="og:description" content="Adds inactive replicates to a survey design object. An inactive
replicate is a replicate that does not contribute to variance estimates but
adds to the matrix of replicate weights so that the matrix has the desired
number of columns. The new replicates' values are simply equal to the full-sample weights."><meta property="og:image" content="https://bschneidr.github.io/svrep/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bootstrap-replicates.html">Bootstrap Methods for Surveys</a></li>
    <li><a class="dropdown-item" href="../articles/nonresponse-adjustments.html">Nonresponse Adjustments</a></li>
    <li><a class="dropdown-item" href="../articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a></li>
    <li><a class="dropdown-item" href="../articles/two-phase-sampling.html">Replication Methods for Two-phase Sampling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add inactive replicates to a survey design object</h1>
      <small class="dont-index">Source: <a href="https://github.com/bschneidr/svrep/blob/main/R/add_inactive_replicates.R" class="external-link"><code>R/add_inactive_replicates.R</code></a></small>
      <div class="d-none name"><code>add_inactive_replicates.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Adds inactive replicates to a survey design object. An inactive
replicate is a replicate that does not contribute to variance estimates but
adds to the matrix of replicate weights so that the matrix has the desired
number of columns. The new replicates' values are simply equal to the full-sample weights.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_inactive_replicates</span><span class="op">(</span><span class="va">design</span>, <span class="va">n_total</span>, <span class="va">n_to_add</span>, location <span class="op">=</span> <span class="st">"last"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>A survey design object, created with either the <code>survey</code> or <code>srvyr</code> packages.</p></dd>


<dt id="arg-n-total">n_total<a class="anchor" aria-label="anchor" href="#arg-n-total"></a></dt>
<dd><p>The total number of replicates
that the result should contain. If the design already contains <code>n_total</code>
replicates (or more), then no update is made.</p></dd>


<dt id="arg-n-to-add">n_to_add<a class="anchor" aria-label="anchor" href="#arg-n-to-add"></a></dt>
<dd><p>The number of additional replicates to add.
Can only use the <code>n_total</code> argument OR the <code>n_to_add</code> argument,
not both.</p></dd>


<dt id="arg-location">location<a class="anchor" aria-label="anchor" href="#arg-location"></a></dt>
<dd><p>Either <code>"first"</code>, <code>"last"</code> (the default), or <code>"random"</code>.
Specifies where the columns of new replicates should be located in the
matrix of replicate weights. Use <code>"first"</code>
to place new replicates first (i.e., in the leftmost part of the matrix),
<code>"last"</code> to place the new replicates last (i.e., in the rightmost part
of the matrix). Use <code>"random"</code> to intersperse the new replicates
in random column locations of the matrix; the original replicates will
still be in their original order.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An updated survey design object, where the number of columns
of replicate weights has potentially increased. The increase only happens
if the user specifies the <code>n_to_add</code> argument instead of <code>n_total</code>,
of if the user specifies <code>n_total</code> and <code>n_total</code> is less than the number
of columns of replicate weights that the design already had.</p>
    </div>
    <div class="section level2">
    <h2 id="statistical-details">Statistical Details<a class="anchor" aria-label="anchor" href="#statistical-details"></a></h2>


<p>Inactive replicates are also sometimes referred to as "dead replicates",
for example in Ash (2014). The purpose of adding inactive replicates
is to increase the number of columns of replicate weights without impacting
variance estimates. This can be useful, for example, when combining data
from a survey across multiple years, where different years use different number
of replicates, but a consistent number of replicates is desired in the combined
data file.</p>
<p>Suppose the initial replicate design has \(L\) replicates, with
respective constants \(c_k\) for \(k=1,\dots,L\) used to estimate variance
with the formula
$$v_{R} = \sum_{k=1}^L c_k\left(\hat{T}_y^{(k)}-\hat{T}_y\right)^2$$
where \(\hat{T}_y\) is the estimate produced using the full-sample weights
and \(\hat{T}_y^{(k)}\) is the estimate from replicate \(k\).</p>
<p>Inactive replicates are simply replicates that are exactly equal to the full sample:
that is, the replicate \(k\) is called "inactive" if its vector of replicate
weights exactly equals the full-sample weights. In this case, when using the formula
above to estimate variances, these replicates contribute nothing to the variance estimate.</p>
<p>If the analyst uses the variant of the formula above where the full-sample estimate
\(\hat{T}_y\) is replaced by the average replicate estimate (i.e., \(L^{-1}\sum_{k=1}^{L}\hat{T}_y^{(k)}\)),
then variance estimates will differ before vs. after adding the inactive replicates.
For this reason, it is strongly recommend to explicitly specify <code>mse=TRUE</code>
when creating a replicate design object in R with functions such as <code><a href="https://rdrr.io/pkg/survey/man/svrepdesign.html" class="external-link">svrepdesign()</a></code>,
<code><a href="as_bootstrap_design.html">as_bootstrap_design()</a></code>, etc. If working with an already existing replicate design,
you can update the <code>mse</code> option to <code>TRUE</code> simply by using code such as
<code>my_design$mse &lt;- TRUE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Ash, S. (2014). "<em>Using successive difference replication for estimating variances</em>."
<strong>Survey Methodology</strong>, Statistics Canada, 40(1), 47-59.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: grid</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: Matrix</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: survival</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘survey’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:graphics’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     dotchart</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create an example survey design object</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    PSU     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">survey_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">sample_data</span>,</span></span>
<span class="r-in"><span>    ids <span class="op">=</span> <span class="op">~</span> <span class="va">PSU</span>,</span></span>
<span class="r-in"><span>    weights <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">rep_design</span> <span class="op">&lt;-</span> <span class="va">survey_design</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/as.svrepdesign.html" class="external-link">as.svrepdesign</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"JK1"</span>, mse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect replicates before subsampling</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">rep_design</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"analysis"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  0.0  1.5  1.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  1.5  0.0  1.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  1.5  1.5  0.0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect replicates after adding inactive replicates</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">rep_design</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">add_inactive_replicates</span><span class="op">(</span>n_total <span class="op">=</span> <span class="fl">5</span>, location <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"analysis"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3] [,4] [,5]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    1  0.0  1.5  1.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    1    1  1.5  0.0  1.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    1    1  1.5  1.5  0.0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">rep_design</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">add_inactive_replicates</span><span class="op">(</span>n_to_add <span class="op">=</span> <span class="fl">2</span>, location <span class="op">=</span> <span class="st">"last"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"analysis"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3] [,4] [,5]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  0.0  1.5  1.5    1    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  1.5  0.0  1.5    1    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  1.5  1.5  0.0    1    1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">rep_design</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu">add_inactive_replicates</span><span class="op">(</span>n_to_add <span class="op">=</span> <span class="fl">5</span>, location <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"analysis"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    1    1  0.0    1  1.5    1  1.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    1    1    1  1.5    1  0.0    1  1.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    1    1    1  1.5    1  1.5    1  0.0</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

