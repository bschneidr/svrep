<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Sample-based Calibration to An Estimate — calibrate_to_estimate • svrep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sample-based Calibration to An Estimate — calibrate_to_estimate"><meta name="description" content="Calibrate the weights of a primary survey to match estimated totals from a control survey,
using adjustments to the replicate weights to account for the variance of the estimated control totals.
The adjustments to replicate weights are conducted using the method proposed by Fuller (1998).
This method can be used to implement general calibration as well as post-stratification or raking specifically
(see the details for the calfun parameter)."><meta property="og:description" content="Calibrate the weights of a primary survey to match estimated totals from a control survey,
using adjustments to the replicate weights to account for the variance of the estimated control totals.
The adjustments to replicate weights are conducted using the method proposed by Fuller (1998).
This method can be used to implement general calibration as well as post-stratification or raking specifically
(see the details for the calfun parameter)."><meta property="og:image" content="https://bschneidr.github.io/svrep/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bootstrap-replicates.html">Bootstrap Methods for Surveys</a></li>
    <li><a class="dropdown-item" href="../articles/nonresponse-adjustments.html">Nonresponse Adjustments</a></li>
    <li><a class="dropdown-item" href="../articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a></li>
    <li><a class="dropdown-item" href="../articles/two-phase-sampling.html">Replication Methods for Two-phase Sampling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Sample-based Calibration to An Estimate</h1>
      <small class="dont-index">Source: <a href="https://github.com/bschneidr/svrep/blob/main/R/calibrate_to_estimate.R" class="external-link"><code>R/calibrate_to_estimate.R</code></a></small>
      <div class="d-none name"><code>calibrate_to_estimate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calibrate the weights of a primary survey to match estimated totals from a control survey,
using adjustments to the replicate weights to account for the variance of the estimated control totals.
The adjustments to replicate weights are conducted using the method proposed by Fuller (1998).
This method can be used to implement general calibration as well as post-stratification or raking specifically
(see the details for the <code>calfun</code> parameter).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calibrate_to_estimate</span><span class="op">(</span></span>
<span>  <span class="va">rep_design</span>,</span>
<span>  <span class="va">estimate</span>,</span>
<span>  <span class="va">vcov_estimate</span>,</span>
<span>  <span class="va">cal_formula</span>,</span>
<span>  calfun <span class="op">=</span> <span class="fu">survey</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.linear</a></span>,</span>
<span>  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, upper <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">1e-07</span>,</span>
<span>  variance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  col_selection <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-rep-design">rep_design<a class="anchor" aria-label="anchor" href="#arg-rep-design"></a></dt>
<dd><p>A replicate design object for the primary survey, created with either the <code>survey</code> or <code>srvyr</code> packages.</p></dd>


<dt id="arg-estimate">estimate<a class="anchor" aria-label="anchor" href="#arg-estimate"></a></dt>
<dd><p>A vector of estimated control totals.
The names of entries must match the names from calling <code>svytotal(x = cal_formula, design = rep_design)</code>.</p></dd>


<dt id="arg-vcov-estimate">vcov_estimate<a class="anchor" aria-label="anchor" href="#arg-vcov-estimate"></a></dt>
<dd><p>A variance-covariance matrix for the estimated control totals.
The column names and row names must match the names of <code>estimate</code>.</p></dd>


<dt id="arg-cal-formula">cal_formula<a class="anchor" aria-label="anchor" href="#arg-cal-formula"></a></dt>
<dd><p>A formula listing the variables to use for calibration.
All of these variables must be included in <code>rep_design</code>.</p></dd>


<dt id="arg-calfun">calfun<a class="anchor" aria-label="anchor" href="#arg-calfun"></a></dt>
<dd><p>A calibration function from the <code>survey</code> package,
such as <a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.linear</a>, <a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.raking</a>, or <a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.logit</a>.
Use <code>cal.linear</code> for ordinary post-stratification, and <code>cal.raking</code> for raking.
See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for additional details.</p></dd>


<dt id="arg-bounds">bounds<a class="anchor" aria-label="anchor" href="#arg-bounds"></a></dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt id="arg-maxit">maxit<a class="anchor" aria-label="anchor" href="#arg-maxit"></a></dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt id="arg-epsilon">epsilon<a class="anchor" aria-label="anchor" href="#arg-epsilon"></a></dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. <br>
After calibration, the absolute difference between each calibration target and the calibrated estimate
will be no larger than <code>epsilon</code> times (1 plus the absolute value of the target).
See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt id="arg-variance">variance<a class="anchor" aria-label="anchor" href="#arg-variance"></a></dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt id="arg-col-selection">col_selection<a class="anchor" aria-label="anchor" href="#arg-col-selection"></a></dt>
<dd><p>Optional parameter to determine which replicate columns
will have their control totals perturbed. If supplied, <code>col_selection</code> must be an integer vector
with length equal to the length of <code>estimate</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A replicate design object, with full-sample weights calibrated to totals from <code>estimate</code>,
and replicate weights adjusted to account for variance of the control totals.
The element <code>col_selection</code> indicates, for each replicate column of the calibrated primary survey,
which column of replicate weights it was matched to from the control survey.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>With the Fuller method, each of <code>k</code> randomly-selected replicate columns from the primary survey
are calibrated to control totals formed by perturbing the <code>k</code>-dimensional vector of
estimated control totals using a spectral decomposition of the variance-covariance matrix
of the estimated control totals. Other replicate columns are simply calibrated to the unperturbed control totals.
<br></p>
<p>Because the set of replicate columns whose control totals are perturbed should be random,
there are multiple ways to ensure that this matching is reproducible.
The user can either call <a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a> before using the function,
or supply a vector of randomly-selected column indices to the argument <code>col_selection</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="syntax-for-common-types-of-calibration">Syntax for Common Types of Calibration<a class="anchor" aria-label="anchor" href="#syntax-for-common-types-of-calibration"></a></h2>


<p>For ratio estimation with an auxiliary variable <code>X</code>,
use the following options: <br>
  - <code>cal_formula = ~ -1 + X</code> <br>
  - <code>variance = 1</code>, <br>
  - <code>cal.fun = survey::cal.linear</code></p>
<p>For post-stratification, use the following option:</p>
<p>- <code>cal.fun = survey::cal.linear</code></p>
<p>For raking, use the following option:</p>
<p>- <code>cal.fun = survey::cal.raking</code></p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fuller, W.A. (1998).
"Replication variance estimation for two-phase samples."
<strong>Statistica Sinica</strong>, <em>8</em>: 1153-1164.</p>
<p>Opsomer, J.D. and A. Erciulescu (2021).
"Replication variance estimation after sample-based calibration."
<strong>Survey Methodology</strong>, <em>47</em>: 265-277.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>[calibrate_to_sample()] as
an alternative when the control survey has replicate weights.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load example data for primary survey ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">primary_survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">dnum</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apiclus1</span>, fpc<span class="op">=</span><span class="op">~</span><span class="va">fpc</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/as.svrepdesign.html" class="external-link">as.svrepdesign</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"JK1"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load example data for control survey ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">control_survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>id <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, fpc <span class="op">=</span> <span class="op">~</span><span class="va">fpc</span>, data <span class="op">=</span> <span class="va">apisrs</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/as.svrepdesign.html" class="external-link">as.svrepdesign</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"JK1"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimate control totals ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">estimated_controls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>,</span></span>
<span class="r-in"><span>                                 design <span class="op">=</span> <span class="va">control_survey</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">control_point_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">estimated_controls</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">control_vcov_estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">estimated_controls</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calibrate totals for one categorical variable and one numeric ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">calibrated_rep_design</span> <span class="op">&lt;-</span> <span class="fu">calibrate_to_estimate</span><span class="op">(</span></span></span>
<span class="r-in"><span>    rep_design <span class="op">=</span> <span class="va">primary_survey</span>,</span></span>
<span class="r-in"><span>    estimate <span class="op">=</span> <span class="va">control_point_estimates</span>,</span></span>
<span class="r-in"><span>    vcov_estimate <span class="op">=</span> <span class="va">control_vcov_estimate</span>,</span></span>
<span class="r-in"><span>    cal_formula <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selection of replicate columns whose control totals will be perturbed will be done at random.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> For tips on reproducible selection, see `help('calibrate_to_estimate')`</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Setting `mse` to TRUE; variance estimates will be centered around full-sample estimate, not mean of replicates.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect estimates before and after calibration ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">##_ For the calibration variables, estimates and standard errors</span></span></span>
<span class="r-in"><span>  <span class="co">##_ from calibrated design will match those of the control survey</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>, design <span class="op">=</span> <span class="va">primary_survey</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             total        SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeE    4873.97   1333.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeH     473.86    158.70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeM     846.17    167.55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 3404940.13 932235.03</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>, design <span class="op">=</span> <span class="va">control_survey</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             total        SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeE    4397.74    196.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeH     774.25    142.85</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeM    1022.01    160.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 3621074.34 169519.65</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>, design <span class="op">=</span> <span class="va">calibrated_rep_design</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             total        SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeE    4397.74    196.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeH     774.25    142.85</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeM    1022.01    160.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 3621074.34 169519.65</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">##_ Estimates from other variables will be changed as well</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">api00</span> <span class="op">+</span> <span class="va">api99</span>, design <span class="op">=</span> <span class="va">primary_survey</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 644.17 26.329</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api99 606.98 26.998</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">api00</span> <span class="op">+</span> <span class="va">api99</span>, design <span class="op">=</span> <span class="va">control_survey</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 656.58 9.2497</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api99 624.68 9.5003</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">api00</span> <span class="op">+</span> <span class="va">api99</span>, design <span class="op">=</span> <span class="va">calibrated_rep_design</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 642.69 27.995</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api99 606.91 28.681</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect weights before and after calibration ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="summarize_rep_weights.html">summarize_rep_weights</a></span><span class="op">(</span><span class="va">primary_survey</span>, type <span class="op">=</span> <span class="st">'overall'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   nrows ncols degf_svy_pkg rank avg_wgt_sum sd_wgt_sums min_rep_wgt max_rep_wgt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   183    15           14   15        6194    403.1741           0    36.26464</span>
<span class="r-in"><span>  <span class="fu"><a href="summarize_rep_weights.html">summarize_rep_weights</a></span><span class="op">(</span><span class="va">calibrated_rep_design</span>, type <span class="op">=</span> <span class="st">'overall'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   nrows ncols degf_svy_pkg rank avg_wgt_sum  sd_wgt_sums min_rep_wgt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   183    15           14   15        6194 4.734925e-09           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   max_rep_wgt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    119.1069</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For reproducibility, specify which columns are randomly selected for Fuller method ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">column_selection</span> <span class="op">&lt;-</span> <span class="va">calibrated_rep_design</span><span class="op">$</span><span class="va">col_selection</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">column_selection</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2  1 12  5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">calibrated_rep_design</span> <span class="op">&lt;-</span> <span class="fu">calibrate_to_estimate</span><span class="op">(</span></span></span>
<span class="r-in"><span>    rep_design <span class="op">=</span> <span class="va">primary_survey</span>,</span></span>
<span class="r-in"><span>    estimate <span class="op">=</span> <span class="va">control_point_estimates</span>,</span></span>
<span class="r-in"><span>    vcov_estimate <span class="op">=</span> <span class="va">control_vcov_estimate</span>,</span></span>
<span class="r-in"><span>    cal_formula <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>,</span></span>
<span class="r-in"><span>    col_selection <span class="op">=</span> <span class="va">column_selection</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Setting `mse` to TRUE; variance estimates will be centered around full-sample estimate, not mean of replicates.</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

