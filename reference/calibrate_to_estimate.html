<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Calibrate the weights of a primary survey to match estimated totals from a control survey,
using adjustments to the replicate weights to account for the variance of the estimated control totals.
The adjustments to replicate weights are conducted using the method proposed by Fuller (1998).
This method can be used to implement general calibration as well as post-stratification or raking specifically
(see the details for the calfun parameter)."><title>Calibrate weights from a primary survey to estimated totals from a control survey,
with replicate-weight adjustments that account for variance of the control totals — calibrate_to_estimate • svrep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calibrate weights from a primary survey to estimated totals from a control survey,
with replicate-weight adjustments that account for variance of the control totals — calibrate_to_estimate"><meta property="og:description" content="Calibrate the weights of a primary survey to match estimated totals from a control survey,
using adjustments to the replicate weights to account for the variance of the estimated control totals.
The adjustments to replicate weights are conducted using the method proposed by Fuller (1998).
This method can be used to implement general calibration as well as post-stratification or raking specifically
(see the details for the calfun parameter)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">svrep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/nonresponse-adjustments.html">Nonresponse Adjustments</a>
    <a class="dropdown-item" href="../articles/sample-based-calibration.html">Calibrating to Estimated Control Totals</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bschneidr/svrep/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calibrate weights from a primary survey to estimated totals from a control survey,
with replicate-weight adjustments that account for variance of the control totals</h1>
      <small class="dont-index">Source: <a href="https://github.com/bschneidr/svrep/blob/HEAD/R/calibrate_to_estimate.R" class="external-link"><code>R/calibrate_to_estimate.R</code></a></small>
      <div class="d-none name"><code>calibrate_to_estimate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calibrate the weights of a primary survey to match estimated totals from a control survey,
using adjustments to the replicate weights to account for the variance of the estimated control totals.
The adjustments to replicate weights are conducted using the method proposed by Fuller (1998).
This method can be used to implement general calibration as well as post-stratification or raking specifically
(see the details for the <code>calfun</code> parameter).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calibrate_to_estimate</span><span class="op">(</span></span>
<span>  <span class="va">rep_design</span>,</span>
<span>  <span class="va">estimate</span>,</span>
<span>  <span class="va">vcov_estimate</span>,</span>
<span>  <span class="va">cal_formula</span>,</span>
<span>  calfun <span class="op">=</span> <span class="fu">survey</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.linear</a></span>,</span>
<span>  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, upper <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">1e-07</span>,</span>
<span>  variance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  col_selection <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>rep_design</dt>
<dd><p>A replicate design object for the primary survey, created with either the <code>survey</code> or <code>srvyr</code> packages.</p></dd>


<dt>estimate</dt>
<dd><p>A vector of estimated control totals.
The names of entries must match the names from calling <code>svytotal(x = cal_formula, design = rep_design)</code>.</p></dd>


<dt>vcov_estimate</dt>
<dd><p>A variance-covariance matrix for the estimated control totals.
The column names and row names must match the names of <code>estimate</code>.</p></dd>


<dt>cal_formula</dt>
<dd><p>A formula listing the variables to use for calibration.
All of these variables must be included in <code>rep_design</code>.</p></dd>


<dt>calfun</dt>
<dd><p>A calibration function from the <code>survey</code> package,
such as <a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.linear</a>, <a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.raking</a>, or <a href="https://rdrr.io/pkg/survey/man/make.calfun.html" class="external-link">cal.logit</a>.
Use <code>cal.linear</code> for ordinary post-stratification, and <code>cal.raking</code> for raking.
See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for additional details.</p></dd>


<dt>bounds</dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt>verbose</dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt>maxit</dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt>epsilon</dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. <br>
After calibration, the absolute difference between each calibration target and the calibrated estimate
will be no larger than <code>epsilon</code> times (1 plus the absolute value of the target).
See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt>variance</dt>
<dd><p>Parameter passed to <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">grake</a> for calibration. See <a href="https://rdrr.io/pkg/survey/man/calibrate.html" class="external-link">calibrate</a> for details.</p></dd>


<dt>col_selection</dt>
<dd><p>Optional parameter to determine which replicate columns
will have their control totals perturbed. If supplied, <code>col_selection</code> must be an integer vector
with length equal to the length of <code>estimate</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A replicate design object, with full-sample weights calibrated to totals from <code>estimate</code>,
and replicate weights adjusted to account for variance of the control totals.
The element <code>col_selection</code> indicates, for each replicate column of the calibrated primary survey,
which column of replicate weights it was matched to from the control survey.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>With the Fuller method, each of <code>k</code> randomly-selected replicate columns from the primary survey
are calibrated to control totals formed by perturbing the <code>k</code>-dimensional vector of
estimated control totals using a spectral decomposition of the variance-covariance matrix
of the estimated control totals. Other replicate columns are simply calibrated to the unperturbed control totals.
<br></p>
<p>Because the set of replicate columns whose control totals are perturbed should be random,
there are multiple ways to ensure that this matching is reproducible.
The user can either call <a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a> before using the function,
or supply a vector of randomly-selected column indices to the argument <code>col_selection</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fuller, W.A. (1998).
"Replication variance estimation for two-phase samples."
<strong>Statistica Sinica</strong>, <em>8</em>: 1153-1164.</p>
<p>Opsomer, J.D. and A. Erciulescu (2021).
"Replication variance estimation after sample-based calibration."
<strong>Survey Methodology</strong>, <em>47</em>: 265-277.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load example data for primary survey ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">primary_survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">dnum</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apiclus1</span>, fpc<span class="op">=</span><span class="op">~</span><span class="va">fpc</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/as.svrepdesign.html" class="external-link">as.svrepdesign</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"JK1"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load example data for control survey ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">control_survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>id <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, fpc <span class="op">=</span> <span class="op">~</span><span class="va">fpc</span>, data <span class="op">=</span> <span class="va">apisrs</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/as.svrepdesign.html" class="external-link">as.svrepdesign</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"JK1"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimate control totals ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">estimated_controls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>,</span></span>
<span class="r-in"><span>                                 design <span class="op">=</span> <span class="va">control_survey</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">control_point_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">estimated_controls</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">control_vcov_estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">estimated_controls</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calibrate totals for one categorical variable and one numeric ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">calibrated_rep_design</span> <span class="op">&lt;-</span> <span class="fu">calibrate_to_estimate</span><span class="op">(</span></span></span>
<span class="r-in"><span>    rep_design <span class="op">=</span> <span class="va">primary_survey</span>,</span></span>
<span class="r-in"><span>    estimate <span class="op">=</span> <span class="va">control_point_estimates</span>,</span></span>
<span class="r-in"><span>    vcov_estimate <span class="op">=</span> <span class="va">control_vcov_estimate</span>,</span></span>
<span class="r-in"><span>    cal_formula <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Selection of replicate columns whose control totals will be perturbed will be done at random.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> For tips on reproducible selection, see `help('calibrate_to_estimate')`</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Setting `mse` to TRUE; variance estimates will be centered around full-sample estimate, not mean of replicates.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect estimates before and after calibration ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">##_ For the calibration variables, estimates and standard errors</span></span></span>
<span class="r-in"><span>  <span class="co">##_ from calibrated design will match those of the control survey</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>, design <span class="op">=</span> <span class="va">primary_survey</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             total        SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeE    4873.97   1333.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeH     473.86    158.70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeM     846.17    167.55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 3404940.13 932235.03</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>, design <span class="op">=</span> <span class="va">control_survey</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             total        SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeE    4397.74    196.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeH     774.25    142.85</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeM    1022.01    160.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 3621074.34 169519.65</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svytotal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>, design <span class="op">=</span> <span class="va">calibrated_rep_design</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             total        SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeE    4397.74    196.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeH     774.25    142.85</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stypeM    1022.01    160.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 3621074.34 169519.65</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">##_ Estimates from other variables will be changed as well</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">api00</span> <span class="op">+</span> <span class="va">api99</span>, design <span class="op">=</span> <span class="va">primary_survey</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 644.17 26.329</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api99 606.98 26.998</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">api00</span> <span class="op">+</span> <span class="va">api99</span>, design <span class="op">=</span> <span class="va">control_survey</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 656.58 9.2497</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api99 624.68 9.5003</span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">api00</span> <span class="op">+</span> <span class="va">api99</span>, design <span class="op">=</span> <span class="va">calibrated_rep_design</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 642.69 27.344</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api99 606.91 28.270</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect weights before and after calibration ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="summarize_rep_weights.html">summarize_rep_weights</a></span><span class="op">(</span><span class="va">primary_survey</span>, type <span class="op">=</span> <span class="st">'overall'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   nrows ncols degf_svy_pkg rank avg_wgt_sum sd_wgt_sums min_rep_wgt max_rep_wgt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   183    15           14   15        6194    403.1741           0    36.26464</span>
<span class="r-in"><span>  <span class="fu"><a href="summarize_rep_weights.html">summarize_rep_weights</a></span><span class="op">(</span><span class="va">calibrated_rep_design</span>, type <span class="op">=</span> <span class="st">'overall'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   nrows ncols degf_svy_pkg rank avg_wgt_sum  sd_wgt_sums min_rep_wgt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   183    15           14   15        6194 4.905592e-09           0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   max_rep_wgt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    119.1069</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For reproducibility, specify which columns are randomly selected for Fuller method ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">column_selection</span> <span class="op">&lt;-</span> <span class="va">calibrated_rep_design</span><span class="op">$</span><span class="va">col_selection</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">column_selection</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  4  1 11 12</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">calibrated_rep_design</span> <span class="op">&lt;-</span> <span class="fu">calibrate_to_estimate</span><span class="op">(</span></span></span>
<span class="r-in"><span>    rep_design <span class="op">=</span> <span class="va">primary_survey</span>,</span></span>
<span class="r-in"><span>    estimate <span class="op">=</span> <span class="va">control_point_estimates</span>,</span></span>
<span class="r-in"><span>    vcov_estimate <span class="op">=</span> <span class="va">control_vcov_estimate</span>,</span></span>
<span class="r-in"><span>    cal_formula <span class="op">=</span> <span class="op">~</span> <span class="va">stype</span> <span class="op">+</span> <span class="va">enroll</span>,</span></span>
<span class="r-in"><span>    col_selection <span class="op">=</span> <span class="va">column_selection</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Setting `mse` to TRUE; variance estimates will be centered around full-sample estimate, not mean of replicates.</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ben Schneider.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

